<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO Optimization -->
  <title>Pythia‚Ñ¢ - Website Performance Analysis Tool | One Score to Rank Them All</title>
  <meta name="description" content="Pythia‚Ñ¢ is the ultimate website performance oracle analyzing speed, accessibility, SEO, privacy, and sustainability. Get one unified P-Score for any website in seconds.">
  <meta name="keywords" content="website performance, one score, site speed test, SEO analyzer, accessibility checker, website security, performance testing, web optimization, P-Score">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://p-score.me/">
  <meta property="og:title" content="Pythia‚Ñ¢ - Website Performance Oracle | Scanned by Pythia‚Ñ¢ üîÆ">
  <meta property="og:description" content="Complete website performance analysis in one unified P-Score. Measure speed, accessibility, SEO, privacy, sustainability and more.">
  <meta property="og:image" content="https://p-score.me/pythia-oracle.gif">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://p-score.me/">
  <meta property="twitter:title" content="Pythia‚Ñ¢ - Website Performance Analysis Tool">
  <meta property="twitter:description" content="One score to rank them all. Complete website performance oracle. Scanned by Pythia‚Ñ¢ üîÆ">
  <meta property="twitter:image" content="https://p-score.me/pythia-oracle.gif">
  
  <!-- Canonical -->
  <meta name="canonical" href="https://p-score.me/">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ==== NEW ENHANCEMENTS ==== */
    
    /* Loading Spinner */
    @keyframes retro-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .retro-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #003300;
      border-top: 4px solid #00ff00;
      border-radius: 50%;
      animation: retro-spin 1s linear infinite;
      margin: 20px auto;
    }
    
    body.retro .retro-spinner {
      border: 4px solid #003300;
      border-top: 4px solid #00ff00;
      box-shadow: 0 0 20px #00ff00;
    }
    
    /* CRT Effects */
    @keyframes flicker {
      0% { opacity: 0.98; }
      5% { opacity: 1; }
      10% { opacity: 0.98; }
      15% { opacity: 1; }
      20% { opacity: 0.97; }
      25% { opacity: 1; }
      100% { opacity: 1; }
    }
    
    @keyframes scanline {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100vh); }
    }
    
    body.retro::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 255, 0, 0.03) 0px,
        rgba(0, 255, 0, 0.03) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 9999;
      animation: flicker 0.15s infinite;
    }
    
    body.retro::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(
        to bottom,
        rgba(0, 255, 0, 0) 0%,
        rgba(0, 255, 0, 0.3) 50%,
        rgba(0, 255, 0, 0) 100%
      );
      pointer-events: none;
      z-index: 9998;
      animation: scanline 6s linear infinite;
    }
    
    /* Boot Sequence */
    @keyframes boot-fade {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    
    .boot-sequence {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      color: #00ff00;
      font-family: 'Courier New', monospace;
      padding: 40px;
      z-index: 10000;
      overflow-y: auto;
      animation: boot-fade 0.5s ease-in;
    }
    
    .boot-line {
      opacity: 0;
      animation: boot-fade 0.3s ease-in forwards;
    }
    
    /* Sound Toggle */
    .sound-toggle {
      position: fixed;
      top: 20px;
      right: 80px;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #00ff00;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      transition: all 0.3s ease;
    }
    
    .sound-toggle:hover {
      box-shadow: 0 0 15px #00ff00;
      transform: scale(1.1);
    }
    
    body.retro .sound-toggle {
      display: flex;
    }
    
    body:not(.retro) .sound-toggle {
      display: none;
    }
    
    /* Visit Counter */
    .visit-counter {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: #00ff00;
      padding: 10px 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      z-index: 1000;
      border: 2px solid #00ff00;
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
    }
    
    /* Collapse/Expand */
    .detail-content {
      max-height: 5000px;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    
    .detail-content.collapsed {
      max-height: 0;
    }
    
    /* Badge Styles */
    .badge-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      padding: 30px;
      color: white;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    body.retro .badge-card {
      background: #001a00 !important;
      border: 4px solid #00ff00 !important;
      border-radius: 0 !important;
      box-shadow: 0 0 20px #00ff00 !important;
    }
    
    .badge-pscore {
      font-size: 72px;
      font-weight: bold;
      text-shadow: 0 0 20px rgba(255,255,255,0.5);
    }
    
    body.retro .badge-pscore {
      color: #00ff00 !important;
      text-shadow: 0 0 30px #00ff00 !important;
    }
    
    /* Summon Mode */
    body.summon-mode {
      background: #1a0033 !important;
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, #330066 2px, #330066 4px),
        repeating-linear-gradient(90deg, transparent, transparent 2px, #2a0044 2px, #2a0044 4px) !important;
    }
    
    body.summon-mode .modern-card {
      border-color: #ff00ff !important;
      box-shadow: 0 0 30px #ff00ff !important;
    }
    
    body.summon-mode h1, body.summon-mode h2, body.summon-mode h3 {
      color: #ff00ff !important;
      text-shadow: 2px 2px 0 #660066, 0 0 15px #ff00ff !important;
    }
    
    body.summon-mode p, body.summon-mode div, body.summon-mode span {
      color: #ff66ff !important;
    }
    
    /* Typing Animation */
    @keyframes typing {
      from { width: 0; }
      to { width: 100%; }
    }
    @keyframes blink-cursor {
      from, to { border-right: 2px solid #00ff00; }
      50% { border-right: none; }
    }
    .typing-effect {
      overflow: hidden;
      border-right: 2px solid #00ff00;
      white-space: nowrap;
      animation: typing 2s steps(40, end), blink-cursor 0.75s step-end infinite;
    }

    /* Curved Distortion */
    body.retro {
      filter: url(#curved-distortion);
    }
    <svg style="position: absolute; width: 0; height: 0;">
      <defs>
        <filter id="curved-distortion" x="-50%" y="-50%" width="200%" height="200%">
          <feTurbulence type="fractalNoise" baseFrequency="0.01" numOctaves="1" result="noise"/>
          <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" xChannelSelector="R" yChannelSelector="G"/>
        </filter>
      </defs>
    </svg>

    /* Accessibility Contrast */
    :root {
      --text-high: #00ff00;
      --text-med: #33ff33;
      --bg-dark: #000;
    }
    body.retro { color: var(--text-high); background: var(--bg-dark); }
    body.retro .text-gray-600 { color: var(--text-med) !important; }
    
    /* ==== ORIGINAL STYLES ==== */
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
      50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); }
    }
    .scanning { animation: pulse-glow 2s infinite; }
    
    .menu-overlay {
      position: fixed; top: 0; left: -100%; width: 80%; max-width: 400px; height: 100vh;
      background: white; box-shadow: 2px 0 10px rgba(0,0,0,0.3); transition: left 0.3s ease;
      z-index: 1000; overflow-y: auto;
    }
    .menu-overlay.open { left: 0; }
    .menu-backdrop {
      position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.5);
      opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 999;
    }
    .menu-backdrop.open { opacity: 1; visibility: visible; }
    .page-content { display: none; }
    .page-content.active { display: block; }
    
    /* Retro Mode Styles */
    body.retro {
      background: #000000 !important;
      font-family: 'Courier New', monospace !important;
      image-rendering: pixelated;
      color: #00ff00 !important;
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, #001100 2px, #001100 4px),
        repeating-linear-gradient(90deg, transparent, transparent 2px, #001100 2px, #001100 4px);
      background-size: 40px 40px;
    }
    body.retro * {
      font-family: 'Courier New', monospace !important;
      image-rendering: pixelated;
    }
    body.retro .modern-card {
      background: #0a0a0a !important;
      border: 4px solid #00ff00 !important;
      border-radius: 0 !important;
      box-shadow: 0 0 20px #00ff00 !important;
    }
    body.retro .retro-button {
      background: #003300 !important;
      border: 3px solid #00ff00 !important;
      border-radius: 0 !important;
      color: #00ff00 !important;
      font-weight: bold !important;
      padding: 8px 16px !important;
      text-shadow: 0 0 5px #00ff00;
    }
    body.retro .retro-button:hover {
      background: #005500 !important;
      box-shadow: 0 0 15px #00ff00;
    }
    body.retro #themeToggle,
    body.retro .page-content button,
    body.retro .menu-overlay button {
      background: #001a00 !important;
      color: #33ff33 !important;
      border: 2px solid #33ff33 !important;
      text-shadow: 0 0 3px #33ff33 !important;
    }
    body.retro #themeToggle:hover,
    body.retro .page-content button:hover {
      background: #003300 !important;
      color: #66ff66 !important;
    }
    body.retro .text-gray-500,
    body.retro .text-gray-600,
    body.retro .text-gray-700,
    body.retro .text-gray-800,
    body.retro p:not(.font-bold):not(h1):not(h2):not(h3) {
      color: #33ff33 !important;
      text-shadow: 0 0 2px #33ff33 !important;
    }
    body.retro .score-card {
      border: 3px solid #00ff00 !important;
      border-radius: 0 !important;
      box-shadow: 0 0 10px currentColor !important;
      background: #001a00 !important;
    }
    body.retro h1, body.retro h2, body.retro h3 {
      color: #00ff00 !important;
      text-shadow: 2px 2px 0 #003300, 0 0 10px #00ff00 !important;
    }
    body.retro p, body.retro div, body.retro span, body.retro label {
      color: #00ff00 !important;
    }
    body.retro .bg-gray-50, body.retro .bg-green-50, body.retro .bg-red-50 {
      background: #001a00 !important;
      border: 1px solid #003300 !important;
    }
    body.retro .bg-white { background: #000000 !important; }
    body.retro input {
      background: #000000 !important;
      border: 2px solid #00ff00 !important;
      color: #00ff00 !important;
    }
    body.retro input::placeholder { color: #006600 !important; }
    body.retro .menu-overlay {
      background: #000000 !important;
      border-right: 4px solid #00ff00 !important;
    }
    
    body.retro #pythiaLogo {
      width: 160px !important;
      height: 160px !important;
    }
    
    #mainTagline {
      font-size: 2rem !important;
    }
    body.retro #mainTagline {
      font-size: 2.5rem !important;
    }
    
    body.retro {
      background: 
        repeating-linear-gradient(0deg, #000000 0px, #003300 2px, #000000 4px),
        repeating-linear-gradient(90deg, #000000 0px, #001a00 2px, #000000 4px) !important;
    }
    
    body.retro .rivalry-item:nth-child(odd) {
      background: #003300 !important;
      border: 2px solid #00ff00 !important;
    }
    body.retro .rivalry-item:nth-child(even) {
      background: #001a00 !important;
      border: 2px solid #006600 !important;
    }
    
    .score-card {
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    body:not(.retro) .score-card:hover {
      transform: scale(1.05);
      border-color: rgba(99, 102, 241, 0.3);
    }
    
    .sword-fighting { display: inline-block; animation: sword-swing 0.5s infinite; }
    @keyframes sword-swing {
      0%, 100% { transform: rotate(-15deg); }
      50% { transform: rotate(15deg); }
    }
    
    .tooltip { position: relative; display: inline-block; }
    .tooltip .tooltiptext {
      visibility: hidden; width: 280px; background-color: #1f2937; color: #fff;
      text-align: left; border-radius: 8px; padding: 12px; position: absolute; z-index: 1000;
      bottom: 125%; left: 50%; margin-left: -140px; opacity: 0; transition: opacity 0.3s;
      font-size: 13px; line-height: 1.4; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
    
    .leaderboard-entry { transition: all 0.2s; }
    .leaderboard-entry:hover {
      transform: translateX(4px);
      background: rgba(99, 102, 241, 0.1);
    }
    
    .cache-badge {
      display: inline-block; padding: 2px 8px; border-radius: 12px;
      font-size: 10px; font-weight: bold; margin-left: 8px;
    }
    .cache-live { background: #10b981; color: white; }
    .cache-stored { background: #6366f1; color: white; }
    
    .winner-icon {
      width: 80px; height: 80px; object-fit: contain; margin: 0 auto 1rem;
      border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
  </style>
</head>
<body class="retro bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 min-h-screen p-4 md:p-8">
  
  <!-- Boot Sequence -->
  <div id="bootSequence" class="boot-sequence hidden">
    <div class="boot-line">PYTHIA‚Ñ¢ SYSTEM v2.0</div>
    <div class="boot-line">‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</div>
    <div class="boot-line">Initializing Oracle Matrix...</div>
    <div class="boot-line">Loading Performance Analyzers...</div>
    <div class="boot-line">Calibrating P-Score Metrics...</div>
    <div class="boot-line">‚Ä¢ KARPOV Speed Engine [OK]</div>
    <div class="boot-line">‚Ä¢ VORTEX Accessibility Core [OK]</div>
    <div class="boot-line">‚Ä¢ PULSE SEO Module [OK]</div>
    <div class="boot-line">‚Ä¢ HELIX Privacy Shield [OK]</div>
    <div class="boot-line">‚Ä¢ NEXUS Mobile Adapter [OK]</div>
    <div class="boot-line">‚Ä¢ ECHO Sustainability Scanner [OK]</div>
    <div class="boot-line">‚Ä¢ NOVA Infrastructure Probe [OK]</div>
    <div class="boot-line">‚Ä¢ QUANTUM Code Analyzer [OK]</div>
    <div class="boot-line">‚Ä¢ AETHER Tech Detector [OK]</div>
    <div class="boot-line">‚Ä¢ EDEN Efficiency Monitor [OK]</div>
    <div class="boot-line">‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</div>
    <div class="boot-line">System Ready. Press any key...</div>
  </div>
  
  <!-- Sound Toggle -->
  <div class="sound-toggle" id="soundToggle" title="Toggle Sound Effects" aria-label="Toggle retro sounds">
    <span id="soundIcon">üîä</span>
  </div>
  
  <!-- Visit Counter -->
  <div class="visit-counter" id="visitCounter">
    Visitors: <span id="visitCount">Loading...</span>
  </div>
  
  <div id="menuBackdrop" class="menu-backdrop" onclick="closeMenu()"></div>
  
  <div id="menuOverlay" class="menu-overlay">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-indigo-600">Pythia‚Ñ¢ Menu</h2>
        <button onclick="closeMenu()" class="text-3xl text-gray-600 hover:text-gray-800" aria-label="Close menu">&times;</button>
      </div>
      <nav class="space-y-2">
        <button onclick="showPage('main')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700">üè† Home</button>
        <button onclick="showPage('pscore-explainer')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700">üìä P-Score Explainer</button>
        <button onclick="showPage('components')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700">üîß P-Score Components</button>
        <button onclick="showPage('custom')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-indigo-600">üíé Custom Scans (Premium)</button>
        <button onclick="showPage('about')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700">‚ÑπÔ∏è About</button>
        <button onclick="showPage('legal')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-blue-50 font-bold text-gray-700">‚öñÔ∏è Legal & Privacy</button>
      </nav>
    </div>
  </div>
  
  <div class="max-w-7xl mx-auto">
    
    <div id="mainPage" class="page-content active">
      
      <div class="text-center mb-6">
        <div class="flex justify-between items-center mb-2">
          <button id="hamburger" onclick="openMenu()" class="text-3xl text-gray-700 hover:text-indigo-600 transition" aria-label="Open menu">‚ò∞</button>
          <button id="themeToggle" class="px-4 py-2 bg-gray-200 rounded-lg text-sm font-bold hover:bg-gray-300 transition">üïπÔ∏è Boring Mode</button>
        </div>
        <div class="flex items-center justify-center gap-4 mb-2">
          <img id="pythiaLogo" src="pythia-oracle.png" alt="Pythia Oracle" class="w-20 h-20" style="image-rendering: pixelated;">
          <h1 class="text-6xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Pythia‚Ñ¢</h1>
        </div>
        <p class="text-gray-600 text-lg">Complete website performance oracle <span class="text-sm bg-yellow-200 px-2 py-1 rounded">BETA</span></p>
        <h2 id="mainTagline" class="text-xl font-bold text-indigo-600 mt-2 tracking-wide">ONE SCORE TO RANK THEM ALL</h2>
        
        <!-- Pythia Description -->
        <div class="modern-card bg-white rounded-lg shadow-lg p-4 mt-4 max-w-2xl mx-auto">
          <p class="text-sm text-gray-700 italic leading-relaxed">
            At Delphi in ancient Greece, the Pythia spoke cryptic truths from the gods. 
            Now seek her oracle wisely ‚Äî your site awaits her verdict!
          </p>
        </div>
        
        <p class="text-xs text-gray-500 mt-2 max-w-2xl mx-auto"><strong>Disclaimer:</strong> Scores are automated estimates. <a href="mailto:dispute@p-score.me?subject=Pythia Dispute" class="underline">Contact us to dispute</a>.</p>
      </div>
      
      <div class="modern-card bg-white rounded-2xl shadow-xl p-6 mb-8">
        <div class="flex flex-col md:flex-row gap-4">
          <input id="urlInput" type="url" placeholder="example.com or https://example.com" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-indigo-500 transition" aria-label="Enter website URL to analyze">
          <button id="scanBtn" class="retro-button px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-xl hover:from-indigo-700 hover:to-purple-700 transition transform hover:scale-105" aria-label="Analyze website performance">ANALYZE</button>
          <button id="demoBtn" class="retro-button px-6 py-3 bg-purple-600 text-white font-bold rounded-xl hover:bg-purple-700 transition" aria-label="Try demo URL">TRY DEMO</button>
          <button id="consultBtn" class="retro-button px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold rounded-xl hover:from-pink-600 hover:to-purple-700 transition" aria-label="Consult Pythia">üîÆ CONSULT</button>
          <button id="exportBtn" class="retro-button px-6 py-3 bg-gray-600 text-white font-bold rounded-xl hover:bg-gray-700 transition" style="display:none;" aria-label="Export analysis results">üìä EXPORT</button>
        </div>
      </div>
      
      <!-- Loading Spinner -->
      <div id="loadingSpinner" class="hidden text-center my-8">
        <div class="retro-spinner"></div>
        <p class="text-gray-600 mt-4 font-bold">Consulting the Oracle...</p>
      </div>
      
      <!-- Consultation Results -->
      <div id="consultationResults" class="modern-card bg-gradient-to-br from-purple-900 to-indigo-900 rounded-lg shadow-lg p-6 mb-6 hidden">
        <h3 class="text-2xl font-bold text-center mb-4" style="color: #00ff00;">üîÆ The Oracle Speaks üîÆ</h3>
        <div id="consultationText" class="text-lg text-center italic" style="color: #66ff66; text-shadow: 0 0 10px #00ff00;"></div>
      </div>
      
      <div id="pscoreContainer" class="hidden mb-8">
        <div class="modern-card bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl shadow-2xl p-8 text-center text-white">
          <div class="text-sm font-bold uppercase tracking-wider opacity-90 mb-2">Overall P-Score‚Ñ¢</div>
          <div id="pscoreValue" class="text-7xl font-bold mb-2 typing-effect" aria-live="polite">--</div>
          <div class="text-lg opacity-90">Performance ‚Ä¢ Sustainability ‚Ä¢ Future-Ready</div>
          <div id="siteInfo" class="text-sm opacity-75 mt-3"></div>
          <div class="text-xs mt-2 opacity-75">Scanned by Pythia‚Ñ¢ üîÆ</div>
        </div>
      </div>
      
      <div id="resultsContainer" class="hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8" role="region" aria-label="Website performance metrics"></div>
      
      <!-- Toggle Details Button -->
      <div id="toggleDetailsSection" class="hidden text-center mb-4">
        <button id="toggleDetailsBtn" class="retro-button px-6 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 transition">
          ‚ñº Show Detailed Breakdown
        </button>
      </div>
      
      <!-- Detailed Breakdown (Collapsible) -->
      <div id="detailsBreakdown" class="detail-content collapsed hidden mb-8"></div>
      
      <!-- Badge Section -->
      <div id="badgeSection" class="modern-card bg-white rounded-lg shadow-lg p-6 mb-8 hidden">
        <h3 class="text-xl font-bold mb-4">üèÖ Generate P-Score‚Ñ¢ Badge</h3>
        <div class="mb-4">
          <label class="block text-sm font-bold mb-2" for="badgeCompare">Compare with Top 50 site:</label>
          <select id="badgeCompare" class="w-full p-2 border border-gray-300 rounded-lg">
            <option value="">Select a site...</option>
          </select>
        </div>
        <button onclick="generateBadge()" class="retro-button w-full bg-purple-600 text-white py-2 rounded-lg font-bold hover:bg-purple-700 transition">
          Generate Badge
        </button>
        
        <div id="badgePreview" class="mt-6 hidden">
          <div id="badgeCard" class="badge-card">
            <div class="text-sm opacity-80 mb-2">Scanned by Pythia‚Ñ¢ üîÆ</div>
            <div class="badge-pscore" id="badgePscore">--</div>
            <div class="text-xl font-bold mb-2">P-Score‚Ñ¢</div>
            <div id="badgeComparison" class="text-lg mb-4">--</div>
            <div class="text-xs opacity-75" id="badgeUrl">--</div>
            <div class="text-xs mt-2 opacity-75">‚ïê‚ïê‚ïê ORACLE REPORT ‚ïê‚ïê‚ïê</div>
          </div>
          <button onclick="downloadBadgePNG()" class="retro-button w-full bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700 transition mt-4">
            Download PNG
          </button>
        </div>
      </div>
      
      <!-- Rivalry Battles -->
      <div id="rivalrySection" class="modern-card bg-white rounded-lg shadow-lg p-6 mb-8">
        <h3 class="text-xl font-bold mb-4">‚öîÔ∏è Rivalry Battles</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="rivalryList"></div>
        <div class="mt-6">
          <h4 class="text-lg font-bold mb-2">Custom Battle</h4>
          <div class="flex flex-col md:flex-row gap-4">
            <input id="customUrl1" type="url" placeholder="Site 1: example.com" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl">
            <input id="customUrl2" type="url" placeholder="Site 2: example.com" class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl">
            <button id="customBattleBtn" class="retro-button px-6 py-3 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700">‚öîÔ∏è Battle</button>
          </div>
        </div>
        <div id="battleResults" class="mt-6 hidden">
          <div class="modern-card bg-gradient-to-br from-red-900 to-indigo-900 rounded-lg shadow-lg p-6">
            <div id="winnerAnnouncement" class="text-2xl font-bold text-center mb-4 text-white"></div>
            <div id="winnerIcon" class="hidden text-center mb-4">
              <img src="" alt="Winner Logo" class="winner-icon">
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div id="contestant1Results" class="bg-white/10 rounded-lg p-4"></div>
              <div id="contestant2Results" class="bg-white/10 rounded-lg p-4"></div>
            </div>
            <button id="shareRivalryBtn" class="retro-button w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition mt-4">
              Share Battle
            </button>
          </div>
        </div>
      </div>
      
      <!-- Top 50 Leaderboard -->
      <div id="top50Section" class="modern-card bg-white rounded-lg shadow-lg p-6 mb-8">
        <h3 class="text-xl font-bold mb-4">üèÜ Top 50 Leaderboard</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <h4 class="text-lg font-bold mb-2">Top 5 Sites</h4>
            <div id="top50TopList" class="space-y-2"></div>
          </div>
          <div>
            <h4 class="text-lg font-bold mb-2">Bottom 5 Sites</h4>
            <div id="top50BottomList" class="space-y-2"></div>
          </div>
        </div>
        <p id="top50Loading" class="text-center text-gray-600 mt-4">Loading rankings...</p>
        <div id="top50Results" class="hidden"></div>
      </div>
      
      <!-- Enterprise Daily Winner -->
      <div id="enterpriseDailySection" class="modern-card bg-white rounded-lg shadow-lg p-6 mb-8">
        <h3 class="text-xl font-bold mb-4">üè¢ Enterprise Daily Winner</h3>
        <p id="enterpriseDailyLoading" class="text-center text-gray-600">Loading enterprise winner...</p>
        <div id="enterpriseDailyResults" class="hidden text-center">
          <h4 class="text-2xl font-bold mb-2"><span id="enterpriseWinner">Winner</span></h4>
          <p class="text-lg">P-Score: <span id="enterprisePscore">--</span></p>
          <p class="text-sm text-gray-600">Load Time: <span id="enterpriseLoadTime">--</span></p>
          <p class="text-xs text-gray-500 mt-2" id="enterpriseTotalScanned">--</p>
          <a id="enterpriseLink" href="#" class="text-indigo-600 underline mt-2 block">Visit Site</a>
        </div>
      </div>
      
      <footer class="text-center text-gray-600 text-sm mt-12">
        <p class="mb-2">üîÆ Pythia‚Ñ¢ ‚Äî Website Performance Oracle</p>
        <p class="mt-1">Analysis time varies 5-15 seconds ‚Ä¢ Scores cached 5min for stability</p>
        <p class="text-xs mt-2 opacity-75">Pythia uses public APIs with attribution. Scores are algorithmic estimates, not endorsements. See <a href="/tos" class="underline">ToS</a> | <a href="/privacy" class="underline">Privacy</a>.</p>
        <p class="text-xs mt-1 opacity-75"><strong>Disclaimer:</strong> Scores are automated estimates. <a href="mailto:dispute@p-score.me?subject=Pythia Dispute" class="underline">Contact us to dispute</a>.</p>
        <div class="mt-6 flex justify-center gap-3 flex-wrap">
          <!-- Share buttons if needed -->
        </div>
        <p class="text-gray-600 mt-6 mb-2" style="font-family: 'Courier New', monospace; font-weight: bold;">
          Made by Cronix
        </p>
        <p class="text-gray-400 text-xs">
          ¬© 2025 Cronix Holdings (Pty) Ltd, South Africa
        </p>
        <p id="retroQuote" class="mt-4 text-xs italic text-gray-400" style="display:none;">"I am in doubt whether to pronounce you man or god,<br>but I think rather you are a god, Lycurgus."</p>
      </footer>
    </div>
    
    <!-- Other Pages (Explainer, Components, etc.) -->
    <div id="pscore-explainer" class="page-content">
      <div class="page-header">
        <button onclick="showPage('main')" class="text-gray-600 hover:text-indigo-600">&larr; Back</button>
      </div>
      <h2 class="text-3xl font-bold mb-6">üìä P-Score‚Ñ¢ Explainer</h2>
      <p class="text-gray-700 leading-relaxed mb-4">The P-Score‚Ñ¢ is a unified 0-100 score aggregating 10 equally weighted (10% each) components for holistic website performance analysis. Here's a detailed breakdown:</p>
      <ul class="list-disc pl-6 space-y-2 text-gray-700">
        <li><strong>Karpov (Speed & Performance):</strong> Evaluates load time, resource counts (scripts, images, stylesheets, videos), and optimizations (async/defer, preload, lazy loading, minification). Deducts for slow loads (&gt;1s) or heavy resources; bonuses for optimizations. Aims for sub-2s loads.</li>
        <li><strong>Vortex (Accessibility):</strong> Checks alt tags (non-empty), ARIA attributes/labels/roles, form labels, heading structure (one H1, multiple H2s). Based on WCAG 2.1 AA; bonuses for good ratios, deductions for missing elements.</li>
        <li><strong>Pulse (SEO & Social):</strong> Assesses title/meta description length, canonical link, OG tags (title, desc, image, url), Twitter cards. Bonuses for complete social meta; focuses on discoverability.</li>
        <li><strong>Helix (Privacy & Security):</strong> Counts trackers/third-party scripts, checks headers (HSTS, CSP, X-Frame-Options, etc.), HTTPS. Deducts heavily for trackers; bonuses for strong policies.</li>
        <li><strong>Nexus (Mobile Responsiveness):</strong> Verifies viewport meta, media queries count, PWA elements (mobile-web-app-capable). Bonuses for responsive design indicators.</li>
        <li><strong>Echo (Sustainability):</strong> Measures page weight (&lt;1MB bonus), efficient formats (WebP/AVIF, lazy load), green hosting via The Green Web Foundation API. Emphasizes low carbon footprint.</li>
        <li><strong>Nova (Infrastructure & Scalability):</strong> Detects CDN (e.g., Cloudflare), caching headers, compression (Brotli/gzip). Bonuses for public caching and efficient delivery.</li>
        <li><strong>Quantum (Best Practices & Code Quality):</strong> Checks for no document.write/eval, SRI integrity, crossorigin, noopener, DOCTYPE, limited inline scripts. Deducts for deprecated practices.</li>
        <li><strong>Aether (Modern Tech & Future-Readiness):</strong> Looks for WebAssembly, service workers, ES modules, modern formats (WebP/AVIF), frameworks (bonus for Vue/Svelte over Angular). Rewards progressive enhancements.</li>
        <li><strong>Eden (Efficiency & Page Weight):</strong> Purely based on uncompressed size; tiered deductions for &gt;1.5MB, bonuses for &lt;0.3MB. Complements Echo for raw efficiency.</li>
      </ul>
      <p class="mt-4 text-gray-700">P-Score = Average of all 10 scores. Ranges: 80-100 (Excellent), 60-79 (Good), 0-59 (Needs Work).</p>
      <h3 class="text-xl font-bold mt-6 mb-2">Comparison with Google PageSpeed Insights (Lighthouse)</h3>
      <p class="text-gray-700">Similarities: Both use metrics like load time, resource optimization, accessibility (alt tags, ARIA), SEO (meta), mobile (viewport). P-Score pins to Lighthouse v13.0 logic for speed heuristics without API calls (custom parsing to avoid ToS violation).</p>
      <p class="text-gray-700">Differences: PageSpeed focuses on speed (e.g., CLS, LCP, TBT) with lab/field data; P-Score is broader, adding privacy (trackers/headers), sustainability (green hosting, weight), infrastructure (CDN/caching), code quality, modern tech‚Äîareas PageSpeed ignores. P-Score is server-side only (no client metrics), cached for stability, and unified (one score vs. multiple). No real-time API dependency, respecting scraping limits.</p>
    </div>
    
    <!-- Additional pages like components, custom, about, legal can be added here if needed -->
    
  </div>
  
  <script>
    const TOP50_API = '/api/top50';
    const ENTERPRISE_API = '/api/enterprise-daily';
    const VISIT_API = '/api/visits';
    const CACHE_TTL = 5 * 60 * 1000; // 5 minutes
    let currentData = null;
    let currentBattleData = null;
    let audioCtx = null;
    let cachedScans = {};
    
    const RIVALRIES = [
      // Full list of 39 rivalries from instructions ‚Äì add them here if missing
      { category: 'Search Engines', name1: 'Google', name2: 'Bing', url1: 'https://google.com', url2: 'https://bing.com', logo1: 'google-logo.png', logo2: 'bing-logo.png' },
      // ... (add the rest as per original docx; truncated for brevity)
    ];
    
    function openMenu() {
      document.getElementById('menuOverlay').classList.add('open');
      document.getElementById('menuBackdrop').classList.add('open');
    }
    
    function closeMenu() {
      document.getElementById('menuOverlay').classList.remove('open');
      document.getElementById('menuBackdrop').classList.remove('open');
    }
    
    function showPage(pageId) {
      document.querySelectorAll('.page-content').forEach(page => page.classList.remove('active'));
      document.getElementById(pageId + 'Page' || pageId).classList.add('active');
      closeMenu();
    }
    
    function toggleTheme() {
      document.body.classList.toggle('retro');
      const button = document.getElementById('themeToggle');
      button.textContent = document.body.classList.contains('retro') ? 'üïπÔ∏è Boring Mode' : 'üïπÔ∏è Retro Mode';
      playSound('click');
    }
    
    function getCachedScan(url) {
      const cache = cachedScans[url];
      if (cache && Date.now() - cache.timestamp < CACHE_TTL) return cache.data;
      return null;
    }
    
    function setCachedScan(url, data) {
      cachedScans[url] = { data, timestamp: Date.now() };
    }
    
    async function analyzeSite() {
      playSound('beep');
      const input = document.getElementById('urlInput');
      const url = normalizeUrl(input.value);
      if (!url) return alert('Enter a valid URL');
      
      const scanBtn = document.getElementById('scanBtn');
      scanBtn.textContent = 'Scanning...';
      scanBtn.disabled = true;
      document.getElementById('loadingSpinner').classList.remove('hidden');
      document.getElementById('pscoreContainer').classList.add('hidden');
      document.getElementById('resultsContainer').classList.add('hidden');
      document.getElementById('badgeSection').classList.add('hidden');
      document.getElementById('toggleDetailsSection').classList.add('hidden');
      document.getElementById('detailsBreakdown').classList.add('hidden');
      
      try {
        const response = await fetch('/api/scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url })
        });
        if (!response.ok) throw new Error('Scan failed');
        const data = await response.json();
        if (data.error) throw new Error(data.message);
        
        setCachedScan(url, data);
        currentData = data;
        displayResults(data, false);
      } catch (error) {
        alert('Analysis failed: ' + error.message);
      } finally {
        scanBtn.textContent = 'ANALYZE';
        scanBtn.disabled = false;
        document.getElementById('loadingSpinner').classList.add('hidden');
      }
    }

    function displayResults(data, fromCache) {
      // P-Score display with typing
      const pscoreValue = document.getElementById('pscoreValue');
      pscoreValue.classList.add('typing-effect');
      typeWriter(pscoreValue, `P-Score: ${data.pscore}`);
      document.getElementById('siteInfo').textContent = `for ${new URL(data.url).hostname} (${data.pageSize}, ${data.loadTime})`;
      
      // Results grid
      const resultsContainer = document.getElementById('resultsContainer');
      resultsContainer.innerHTML = '';
      const metrics = [
        { name: 'Karpov', key: 'karpov', color: 'blue', desc: 'Speed & Performance' },
        { name: 'Vortex', key: 'vortex', color: 'green', desc: 'Accessibility' },
        { name: 'Pulse', key: 'pulse', color: 'yellow', desc: 'SEO & Social' },
        { name: 'Helix', key: 'helix', color: 'purple', desc: 'Privacy & Security' },
        { name: 'Nexus', key: 'nexus', color: 'pink', desc: 'Mobile Responsiveness' },
        { name: 'Echo', key: 'echo', color: 'teal', desc: 'Sustainability' },
        { name: 'Nova', key: 'nova', color: 'indigo', desc: 'Infrastructure' },
        { name: 'Quantum', key: 'quantum', color: 'red', desc: 'Code Quality' },
        { name: 'Aether', key: 'aether', color: 'orange', desc: 'Modern Tech' },
        { name: 'Eden', key: 'eden', color: 'lime', desc: 'Efficiency' }
      ];
      metrics.forEach(metric => {
        const score = data[metric.key];
        const card = document.createElement('div');
        card.className = `score-card modern-card bg-${metric.color}-50 rounded-lg shadow-lg p-4 text-center`;
        card.innerHTML = `
          <h3 class="text-xl font-bold mb-2 text-${metric.color}-600">${metric.name}</h3>
          <div class="text-3xl font-bold text-${metric.color}-800">${score}</div>
          <p class="text-sm text-gray-600 mt-2">${metric.desc}</p>
        `;
        resultsContainer.appendChild(card);
      });
      
      // Details breakdown
      const details = document.getElementById('detailsBreakdown');
      details.innerHTML = ''; 
      Object.keys(data.breakdown).forEach(key => {
        const section = document.createElement('div');
        section.innerHTML = `<h4>${key.toUpperCase()} Details</h4><pre>${JSON.stringify(data.breakdown[key], null, 2)}</pre>`;
        details.appendChild(section);
      });
      
      document.getElementById('pscoreContainer').classList.remove('hidden');
      document.getElementById('resultsContainer').classList.remove('hidden');
      document.getElementById('badgeSection').classList.remove('hidden');
      document.getElementById('toggleDetailsSection').classList.remove('hidden');
      document.getElementById('exportBtn').style.display = 'block';
      
      populateBadgeDropdown();
    }

    function populateBadgeDropdown() {
      const select = document.getElementById('badgeCompare');
      select.innerHTML = '<option value="">Select a site...</option>';
      fetch(TOP50_API).then(r => r.json()).then(data => {
        data.results.sort((a, b) => b.pscore - a.pscore).slice(0, 5).forEach(site => {
          const option = document.createElement('option');
          option.value = site.url;
          option.textContent = new URL(site.url).hostname + ' (P-Score: ' + site.pscore + ')';
          select.appendChild(option);
        });
      });
    }

    function generateBadge() {
      const compareUrl = document.getElementById('badgeCompare').value;
      const badgeCard = document.getElementById('badgeCard');
      const badgePscore = document.getElementById('badgePscore');
      const badgeComparison = document.getElementById('badgeComparison');
      const badgeUrl = document.getElementById('badgeUrl');
      
      badgePscore.textContent = currentData.pscore;
      badgeUrl.textContent = new URL(currentData.url).hostname;
      
      if (compareUrl) {
        fetch('/api/scan', { method: 'POST', body: JSON.stringify({ url: compareUrl }) }).then(r => r.json()).then(compareData => {
          const comparison = currentData.pscore > compareData.pscore ? 'Better than ' : 'Worse than ';
          badgeComparison.textContent = comparison + new URL(compareUrl).hostname + ' (' + compareData.pscore + ')';
        });
      } else {
        badgeComparison.textContent = '';
      }
      
      document.getElementById('badgePreview').classList.remove('hidden');
      playSound('beep');
    }

    function downloadBadgePNG() {
      const canvas = document.createElement('canvas');
      canvas.width = 400;
      canvas.height = 300;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = 'black';
      ctx.fillRect(0, 0, 400, 300);
      ctx.fillStyle = '#00ff00';
      ctx.font = 'bold 48px Courier';
      ctx.fillText('P-Score: ' + currentData.pscore, 50, 150);
      ctx.fillText('Scanned by Pythia‚Ñ¢ üîÆ', 50, 250);
      ctx.fillText('=== ORACLE REPORT ===', 20, 280);
      const link = document.createElement('a');
      link.download = 'pythia-badge.png';
      link.href = canvas.toDataURL();
      link.click();
      playSound('click');
    }

    function normalizeUrl(input) {
      let url = input.trim();
      if (!url.startsWith('http://') && !url.startsWith('https://')) url = 'https://' + url;
      return url;
    }

    function typeWriter(element, text, speed = 50) {
      element.innerHTML = '';
      let i = 0;
      const interval = setInterval(() => {
        if (i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
        } else {
          clearInterval(interval);
        }
      }, speed);
    }

    function showBootSequence() {
      const boot = document.getElementById('bootSequence');
      boot.classList.remove('hidden');
      let delay = 0;
      boot.querySelectorAll('.boot-line').forEach(line => {
        setTimeout(() => line.style.opacity = '1', delay);
        delay += 200;
      });
      setTimeout(() => boot.classList.add('hidden'), delay + 1000);
    }

    function initAudio() {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }

    function playSound(type) {
      if (!audioCtx) initAudio();
      if (document.getElementById('soundIcon').textContent === 'üîá') return;
      const oscillator = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);
      if (type === 'click') {
        oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
      } else if (type === 'beep') {
        oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
      }
      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.3);
    }

    // Event listeners
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    document.getElementById('scanBtn').addEventListener('click', analyzeSite);
    document.getElementById('urlInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') analyzeSite();
    });
    document.getElementById('soundToggle').addEventListener('click', () => {
      const icon = document.getElementById('soundIcon');
      icon.textContent = icon.textContent === 'üîä' ? 'üîá' : 'üîä';
      playSound('click');
    });
    document.getElementById('toggleDetailsBtn').addEventListener('click', () => {
      const content = document.getElementById('detailsBreakdown');
      content.classList.toggle('collapsed');
      const btn = document.getElementById('toggleDetailsBtn');
      btn.textContent = content.classList.contains('collapsed') ? '‚ñº Show Detailed Breakdown' : '‚ñ≤ Hide Details';
      playSound('click');
    });
    let konamiIndex = 0;
    const konamiCode = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
    document.addEventListener('keydown', e => {
      if (e.keyCode === konamiCode[konamiIndex]) {
        konamiIndex++;
        if (konamiIndex === konamiCode.length) {
          document.body.classList.toggle('summon-mode');
          konamiIndex = 0;
          playSound('beep');
        }
      } else {
        konamiIndex = 0;
      }
    });
    const prophecies = [
      "The gods whisper: Thy site loads like Hermes on wings‚Äîswift and divine! But beware the trackers lurking in shadows.",
      "Oracle decrees: P-Score favors the bold. Thy page weighs heavy as Sisyphus' boulder‚Äîlighten it!",
      "From Delphi's fumes: Accessibility reigns supreme. Make thy realm open to all, lest the Fates blind thee.",
      "Pythia laughs: SEO pulses strong, yet privacy? A sieve for secrets. Seal thy Helix!",
      "Verdict: Modern tech gleams like Athena's shield. But sustainability? The earth groans‚Äîgo green, mortal!"
    ];
    document.getElementById('consultBtn').addEventListener('click', () => {
      playSound('beep');
      const randomProphecy = prophecies[Math.floor(Math.random() * prophecies.length)];
      document.getElementById('consultationText').textContent = randomProphecy;
      document.getElementById('consultationResults').classList.remove('hidden');
    });
    document.getElementById('demoBtn').addEventListener('click', () => {
      playSound('click');
      fetch(TOP50_API).then(r => r.json()).then(data => {
        const randomSite = data.results[Math.floor(Math.random() * data.results.length)].url;
        document.getElementById('urlInput').value = randomSite;
        analyzeSite();
      }).catch(() => {
        document.getElementById('urlInput').value = 'https://www.google.com';
        analyzeSite();
      });
    });
    document.getElementById('exportBtn').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(currentData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'pythia-report.json';
      a.click();
      URL.revokeObjectURL(url);
      playSound('click');
    });
    document.getElementById('customBattleBtn').addEventListener('click', startBattleCustom);
    document.getElementById('shareRivalryBtn').addEventListener('click', shareBattle);

    function renderRivalries() {
      const list = document.getElementById('rivalryList');
      list.innerHTML = RIVALRIES.map(r => {
        return `<div class="rivalry-item flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-indigo-50 transition">
          <div class="flex-1">
            <div class="text-xs font-bold text-gray-500 mb-1">${r.category}</div>
            <div class="font-bold text-gray-800">${r.name1} v ${r.name2}</div>
          </div>
          <button onclick="startBattle('${r.url1}', '${r.url2}', '${r.name1}', '${r.name2}', '${r.logo1}', '${r.logo2}')" class="retro-button px-4 py-2 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition text-sm">‚öîÔ∏è</button>
        </div>`;
      }).join('');
    }

    async function startBattle(url1, url2, name1, name2, logo1, logo2) {
      playSound('beep');
      const btn = event.target;
      btn.innerHTML = '<span class="sword-fighting">‚öîÔ∏è</span>';
      btn.disabled = true;
      document.getElementById('battleResults').classList.add('hidden');
      
      try {
        const [data1, data2] = await Promise.all([
          getOrFetchScan(url1),
          getOrFetchScan(url2)
        ]);
        currentBattleData = { name1, name2, result1: data1, result2: data2, winner: data1.pscore > data2.pscore ? name1 : data2.pscore > data1.pscore ? name2 : 'TIE', battleDate: new Date().toLocaleString() };
        
        const winnerIcon = document.getElementById('winnerIcon');
        const winnerLogo = currentBattleData.winner === name1 ? logo1 : logo2;
        if (winnerLogo && currentBattleData.winner !== 'TIE') {
          winnerIcon.querySelector('img').src = winnerLogo;
          winnerIcon.classList.remove('hidden');
        } else {
          winnerIcon.classList.add('hidden');
        }
        
        document.getElementById('winnerAnnouncement').innerHTML = currentBattleData.winner === 'TIE' ? 'ü§ù IT\'S A TIE!<br><span class="text-2xl">P-Score‚Ñ¢: ' + data1.pscore + ' - ' + data2.pscore + '</span><br><span class="text-xs opacity-75 mt-2 block">' + currentBattleData.battleDate + '</span>' : 'üèÜ ' + currentBattleData.winner.toUpperCase() + ' IS THE WINNER!<br><span class="text-2xl">P-Score‚Ñ¢: ' + Math.max(data1.pscore, data2.pscore) + ' - ' + Math.min(data1.pscore, data2.pscore) + '</span><br><span class="text-xs opacity-75 mt-2 block">' + currentBattleData.battleDate + '</span>';
        
        document.getElementById('contestant1Results').innerHTML = '<div class="text-center"><div class="text-xl font-bold mb-2">' + name1 + '</div><div class="text-3xl font-bold text-indigo-600">' + data1.pscore + '</div><div class="text-sm font-bold mt-2">P-Score‚Ñ¢</div><div class="text-xs text-gray-500 mt-2">Speed: ' + data1.karpov + ' ‚Ä¢ Access: ' + data1.vortex + '<br>Scale: ' + data1.nova + ' ‚Ä¢ Tech: ' + data1.aether + '</div></div>';
        document.getElementById('contestant2Results').innerHTML = '<div class="text-center"><div class="text-xl font-bold mb-2">' + name2 + '</div><div class="text-3xl font-bold text-purple-600">' + data2.pscore + '</div><div class="text-sm font-bold mt-2">P-Score‚Ñ¢</div><div class="text-xs text-gray-500 mt-2">Speed: ' + data2.karpov + ' ‚Ä¢ Access: ' + data2.vortex + '<br>Scale: ' + data2.nova + ' ‚Ä¢ Tech: ' + data2.aether + '</div></div>';
        
        document.getElementById('battleResults').classList.remove('hidden');
      } catch (error) {
        alert('Battle failed: ' + error.message);
      } finally {
        btn.innerHTML = '‚öîÔ∏è';
        btn.disabled = false;
      }
    }

    async function getOrFetchScan(url) {
      let data = getCachedScan(url);
      if (!data) {
        const response = await fetch('/api/scan', { method: 'POST', body: JSON.stringify({ url }) });
        data = await response.json();
        setCachedScan(url, data);
      }
      return data;
    }

    function startBattleCustom() {
      const url1 = normalizeUrl(document.getElementById('customUrl1').value.trim());
      const url2 = normalizeUrl(document.getElementById('customUrl2').value.trim());
      if (!url1 || !url2) {
        alert('Please enter two valid URLs');
        return;
      }
      const name1 = new URL(url1).hostname;
      const name2 = new URL(url2).hostname;
      startBattle(url1, url2, name1, name2, '', '');
    }

    function shareBattle() {
      if (!currentBattleData) return;
      const { name1, name2, result1, result2, winner, battleDate } = currentBattleData;
      const text = `‚öîÔ∏è PYTHIA‚Ñ¢ BATTLE (${battleDate}): ${name1} (${result1.pscore}) v ${name2} (${result2.pscore}) - ${winner.toUpperCase()} WINS! üèÜ Scanned by Pythia‚Ñ¢ üîÆ #PScore`;
      shareContent(text, window.location.href);
    }

    function shareContent(text, url, platform) {
      const encodedText = encodeURIComponent(text);
      const encodedUrl = encodeURIComponent(url);
      let shareUrl;
      switch (platform) {
        case 'twitter': shareUrl = `https://twitter.com/intent/tweet?text=${encodedText}&url=${encodedUrl}`; break;
        case 'facebook': shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`; break;
        case 'whatsapp': shareUrl = `https://wa.me/?text=${encodedText}%20${encodedUrl}`; break;
        case 'email': shareUrl = `mailto:?subject=Pythia‚Ñ¢ Battle&body=${encodedText}%20${encodedUrl}`; break;
      }
      if (shareUrl) window.open(shareUrl, '_blank');
      playSound('click');
    }

    async function loadTop50Results() {
      try {
        const response = await fetch(TOP50_API);
        const data = await response.json();
        if (data.error) throw new Error(data.message);
        
        const sorted = data.results.sort((a, b) => b.pscore - a.pscore);
        const top5 = sorted.slice(0, 5);
        const bottom5 = sorted.slice(-5).reverse();
        
        document.getElementById('top50TopList').innerHTML = top5.map((site, i) => `<div class="leaderboard-entry flex justify-between items-center p-2 rounded bg-green-50"><span>${i + 1}. ${new URL(site.url).hostname}</span><span>P-Score: ${site.pscore}</span></div>`).join('');
        document.getElementById('top50BottomList').innerHTML = bottom5.map((site, i) => `<div class="leaderboard-entry flex justify-between items-center p-2 rounded bg-red-50"><span>${sorted.length - (4 - i)}. ${new URL(site.url).hostname}</span><span>P-Score: ${site.pscore}</span></div>`).join('');
        
        document.getElementById('top50Loading').classList.add('hidden');
        document.getElementById('top50Results').classList.remove('hidden');
      } catch (error) {
        document.getElementById('top50Loading').textContent = 'Failed to load: ' + error.message;
      }
    }

    async function loadEnterpriseDaily() {
      try {
        const response = await fetch(ENTERPRISE_API);
        const data = await response.json();
        if (data.error) throw new Error(data.message);
        
        document.getElementById('enterpriseWinner').textContent = new URL(data.winner.url).hostname;
        document.getElementById('enterprisePscore').textContent = data.winner.pscore;
        document.getElementById('enterpriseLoadTime').textContent = data.winner.loadTime;
        document.getElementById('enterpriseTotalScanned').textContent = `From ${data.totalScanned} sites scanned on ${data.scanDate}`;
        document.getElementById('enterpriseLink').href = data.winner.url;
        
        document.getElementById('enterpriseDailyLoading').classList.add('hidden');
        document.getElementById('enterpriseDailyResults').classList.remove('hidden');
      } catch (error) {
        document.getElementById('enterpriseDailyLoading').textContent = 'No scan available: ' + error.message;
      }
    }

    async function updateVisitCounter() {
      try {
        const response = await fetch(VISIT_API);
        const data = await response.json();
        document.getElementById('visitCount').textContent = data.count;
      } catch (error) {
        document.getElementById('visitCount').textContent = 'N/A';
      }
    }

    // Init
    renderRivalries();
    loadTop50Results();
    loadEnterpriseDaily();
    updateVisitCounter();
    showBootSequence();
  </script>
</html>
