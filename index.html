<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pythia ‚Äì Website Performance Oracle (BETA)</title> <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Original Animations */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); }
        }
        .scanning { animation: pulse-glow 2s infinite; }

        /* Original Menu */
        .menu-overlay { position: fixed; top: 0; left: -100%; width: 80%; max-width: 400px; height: 100vh; background: white; box-shadow: 2px 0 10px rgba(0,0,0,0.3); transition: left 0.3s ease; z-index: 1000; overflow-y: auto; }
        .menu-overlay.open { left: 0; }
        .menu-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.5); opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 999; }
        .menu-backdrop.open { opacity: 1; visibility: visible; }
        .page-content { display: none; }
        .page-content.active { display: block; }

        /* Original Retro Styles */
        body.retro { background: #000000 !important; font-family: 'Courier New', monospace !important; image-rendering: pixelated; color: #00ff00 !important; }
        body.retro * { font-family: 'Courier New', monospace !important; image-rendering: pixelated; }
        body.retro .modern-card { background: #0a0a0a !important; border: 4px solid #00ff00 !important; border-radius: 0 !important; box-shadow: 0 0 20px #00ff00 !important; }
        body.retro .retro-button { background: #003300 !important; border: 3px solid #00ff00 !important; border-radius: 0 !important; color: #00ff00 !important; font-weight: bold !important; padding: 8px 16px !important; text-shadow: 0 0 5px #00ff00; }
        body.retro .retro-button:hover { background: #005500 !important; box-shadow: 0 0 15px #00ff00; }
        body.retro #themeToggle, body.retro #soundToggle, body.retro .page-content button, body.retro .menu-overlay button { background: #001a00 !important; color: #33ff33 !important; border: 2px solid #33ff33 !important; text-shadow: 0 0 3px #33ff33 !important; }
        body.retro #themeToggle:hover, body.retro #soundToggle:hover, body.retro .page-content button:hover { background: #003300 !important; color: #66ff66 !important; }
        body.retro .text-gray-500, body.retro .text-gray-600, body.retro .text-gray-700, body.retro .text-gray-800, body.retro p:not(.font-bold):not(h1):not(h2):not(h3) { color: #33ff33 !important; text-shadow: 0 0 2px #33ff33 !important; }
        body.retro .score-card { border: 3px solid #00ff00 !important; border-radius: 0 !important; box-shadow: 0 0 10px currentColor !important; background: #001a00 !important; }
        body.retro h1, body.retro h2, body.retro h3 { color: #00ff00 !important; text-shadow: 2px 2px 0 #003300, 0 0 10px #00ff00 !important; }
        body.retro p, body.retro div, body.retro span, body.retro label { color: #00ff00 !important; }
        body.retro .text-gray-700, body.retro .text-gray-600, body.retro .text-gray-500, body.retro .text-gray-800 { color: #00ff00 !important; }
        body.retro .bg-gray-50, body.retro .bg-green-50, body.retro .bg-red-50 { background: #001a00 !important; border: 1px solid #003300 !important; }
        body.retro .bg-white { background: #000000 !important; }
        body.retro input { background: #000000 !important; border: 2px solid #00ff00 !important; color: #00ff00 !important; }
        body.retro input::placeholder { color: #006600 !important; }
        body.retro .menu-overlay { background: #000000 !important; border-right: 4px solid #00ff00 !important; }
        
        /* Pythia image 2x bigger (Original was w-20 h-20, new is w-40 h-40) */
        body.retro #oracleImage {
            width: 10rem !important; /* w-40 */
            height: 10rem !important; /* h-40 */
        }
        
        #mainTagline { font-size: 2rem !important; }
        body.retro #mainTagline { font-size: 2.5rem !important; }
        
        /* Stronger retro background */
        body.retro {
            background:
                repeating-linear-gradient(0deg, #000000 0px, #004400 3px, #000000 6px),
                repeating-linear-gradient(90deg, #000000 0px, #002200 3px, #000000 6px) !important;
            background-size: 6px 6px !important;
        }

        /* Rivalry Bars */
        body.retro .rivalry-item:nth-child(odd) { background: #004400 !important; border: 2px solid #00ff00 !important; margin-bottom: 2px !important; }
        body.retro .rivalry-item:nth-child(even) { background: #002200 !important; border: 2px solid #00aa00 !important; margin-bottom: 2px !important; }
        body.retro #scanResults .score-card, body.retro #contestant1Results, body.retro #contestant2Results, body.retro #winnerAnnouncement { color: #00ff66 !important; text-shadow: 0 0 8px #00ff66 !important; }
        body.retro #scanResults .score-card .text-2xl, body.retro #scanResults .score-card .text-3xl, body.retro #contestant1Results .text-3xl, body.retro #contestant2Results .text-3xl { color: #00ff66 !important; text-shadow: 0 0 15px #00ff66, 0 0 25px #00ff00 !important; font-weight: 900 !important; }
        body.retro #winnerAnnouncement { background: #003300 !important; border: 4px solid #00ff66 !important; color: #00ff66 !important; text-shadow: 0 0 10px #00ff66, 2px 2px 0 #001100 !important; }
        
        /* Toggle Buttons */
        body.retro #themeToggle, body.retro #soundToggle { color: #33ff33 !important; background: #002200 !important; text-shadow: 0 0 8px #33ff33, 1px 1px 2px #000 !important; font-weight: 900 !important; border: 3px solid #33ff33 !important; }
        body.retro .back-button, body.retro .about-content, body.retro .weighting-philosophy, body.retro .component-description { color: #33ff33 !important; text-shadow: 0 0 5px #33ff33, 1px 1px 0 #000 !important; }
        
        /* Sword fighting animation */
        @keyframes sword-fight {
            0%, 100% { transform: rotate(-20deg) translateX(-5px); }
            25% { transform: rotate(20deg) translateX(5px); }
            50% { transform: rotate(-20deg) translateX(-5px); }
            75% { transform: rotate(20deg) translateX(5px); }
        }
        .sword-fighting { animation: sword-fight 0.6s infinite; display: inline-block; }
        
        /* Tooltip */
        .tooltip { position: relative; display: inline-block; }
        .tooltip .tooltiptext { visibility: hidden; width: 280px; background-color: #1f2937; color: #fff; text-align: left; border-radius: 8px; padding: 12px; position: absolute; z-index: 1000; bottom: 125%; left: 50%; margin-left: -140px; opacity: 0; transition: opacity 0.3s; font-size: 13px; line-height: 1.4; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .leaderboard-entry { transition: all 0.2s; }
        .leaderboard-entry:hover { transform: translateX(4px); background: rgba(99, 102, 241, 0.1); }
        
        /* Cache Badge */
        .cache-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold; margin-left: 8px; }
        .cache-live { background: #10b981; color: white; }
        .cache-stored { background: #6366f1; color: white; }
        
        /* Sword fighting animation */
        @keyframes sword-fight { 0%, 100% { transform: rotate(-15deg) translateX(-5px); } 25% { transform: rotate(15deg) translateX(5px); } 50% { transform: rotate(-15deg) translateX(-5px); } 75% { transform: rotate(15deg) translateX(5px); } }
        .fighting-swords { animation: sword-fight 0.6s infinite; display: inline-block; font-size: 1.5em; }

        /* --- NEW RETRO STYLES --- */

        /* CRT Scanline Overlay */
        #crtOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.1;
            display: none; /* Hidden by default */
        }
        body.retro #crtOverlay {
            display: block; /* Shown only in retro mode */
        }
        #crtOverlay::before { /* Scanlines */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.05), rgba(0,0,0,0.05) 1px, transparent 1px, transparent 2px);
            opacity: 0.5;
            z-index: 10000;
        }

        /* CRT Flicker Animation */
        @keyframes crt-flicker {
            0%   { opacity: 0.1; }
            5%   { opacity: 0.2; }
            10%  { opacity: 0.1; }
            100% { opacity: 0.1; }
        }
        .crt-flicker {
            animation: crt-flicker 3s infinite step-end; /* Subtle, random flicker */
        }

        /* Curved Distortion Effect */
        body.retro #mainWrapper {
            filter: url(#crt-curve);
        }

        /* Typing Animation */
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #00ff00; }
        }
        .typing {
            overflow: hidden;
            border-right: .15em solid #00ff00;
            white-space: nowrap;
            letter-spacing: .05em;
            animation: 
                typing 1s steps(30, end),
                blink-caret .75s step-end infinite;
        }

        /* Pixellated Fade In */
        @keyframes pixellated-fade {
            0% { filter: blur(20px) brightness(0.1); opacity: 0; }
            50% { filter: blur(10px) brightness(0.5); opacity: 0.5; }
            100% { filter: blur(0px) brightness(1); opacity: 1; }
        }
        .pixellated-fade {
            animation: pixellated-fade 2s ease-in-out forwards;
        }

        /* Retro Spinner */
        @keyframes retro-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .retro-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #00ff00;
            border-top: 2px solid #003300;
            border-radius: 50%;
            animation: retro-spin 1s linear infinite;
            margin-left: 8px;
            vertical-align: middle;
        }

        /* Boot Sequence */
        #bootSequence {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 1.25rem;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        #bootLog {
            width: 100%;
            max-width: 40rem;
            text-align: left;
        }
        .boot-line {
            opacity: 0;
            white-space: nowrap;
        }
        /* Fix for light-on-white text in modern mode sub-pages */
        .menu-overlay p, 
        .menu-overlay div:not(#rivalryList), 
        .menu-overlay span, 
        .menu-overlay a, 
        .menu-overlay li {
            color: #1f2937 !important; /* Force dark gray for readability on white background */
        }

        /* Exception: ensure retro mode text is still bright green */
        body.retro .menu-overlay p, 
        body.retro .menu-overlay div, 
        body.retro .menu-overlay span,
        body.retro .menu-overlay a,
        body.retro .menu-overlay li {
            color: #33ff33 !important;
        }

         #leaderboard {
        display: none !important;
        }
        
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 min-h-screen p-4 md:p-8 retro">

    <div id="bootSequence">
        <pre id="bootLog"></pre>
    </div>

    <div id="crtOverlay" class="crt-flicker"></div>
    <svg style="position: absolute; width: 0; height: 0;">
        <filter id="crt-curve">
            <feTurbulence type="fractalNoise" baseFrequency="0.002 0.002" numOctaves="1" result="warp" />
            <feDisplacementMap in="SourceGraphic" in2="warp" scale="10" xChannelSelector="R" yChannelSelector="G" />
        </filter>
    </svg>

    <div id="menuBackdrop" class="menu-backdrop" onclick="closeMenu()"></div>

    <div id="menuOverlay" class="menu-overlay">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-indigo-600">Menu</h2>
                <button onclick="closeMenu()" class="text-3xl text-gray-600 hover:text-gray-800">√ó</button>
            </div>
            <nav class="space-y-2">
                <button onclick="showPage('main')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700"> üè† Home </button>
                <button onclick="showPage('pscore-explainer')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700"> üìä P-Score Explainer </button>
                <button onclick="showPage('components')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700"> üîß P-Score Components </button>
                <button onclick="showPage('custom')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-indigo-600"> üíé Custom Scans (Premium) </button>
                <button onclick="showPage('about')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-indigo-50 font-bold text-gray-700"> ‚ÑπÔ∏è About </button>
            </nav>
        </div>
    </div>

    <div id="mainWrapper" class="max-w-7xl mx-auto" style="display:none;">

        <div id="mainPage" class="page-content active">

            <div class="text-center mb-6">
                <div class="flex justify-between items-center mb-2">
                    <button id="hamburger" onclick="openMenu()" class="text-3xl text-gray-700 hover:text-indigo-600 transition"> ‚ò∞ </button>
                    <div>
                        <button id="soundToggle" class="px-4 py-2 bg-gray-200 rounded-lg text-sm font-bold hover:bg-gray-300 transition ml-2"> üîä Sounds ON </button>
                        <button id="themeToggle" class="px-4 py-2 bg-gray-200 rounded-lg text-sm font-bold hover:bg-gray-300 transition"> ‚ú® BORING MODE </button>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row items-center justify-center gap-6 mb-2">
                    <div class="flex-1 flex justify-end">
                        <div id="pythiaQuote" class="border-4 border-green-500 p-4 bg-black text-green-400 max-w-md text-left">
                            At Delphi in ancient Greece, the Pythia spoke cryptic truths from the gods. Now seek her oracle wisely ‚Äî your site awaits her verdict!
                        </div>
                    </div>
                    
                    <img id="oracleImage" src="pythia-oracle.png" alt="PythiaTM Oracle" class="w-40 h-40" style="display:block; image-rendering: pixelated;">
                    
                    <div class="flex-1 flex justify-start">
                        <h1 class="text-6xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                            Pythia<sup>TM</sup> 
                        </h1>
                    </div>
                </div>
                <p class="text-gray-600 text-lg">
                    Complete website performance oracle <span class="text-sm bg-yellow-200 px-2 py-1 rounded">BETA</span>
                </p>
                <p id="mainTagline" class="text-xl font-bold text-indigo-600 mt-2 tracking-wide">
                    ONE SCORE TO RANK THEM ALL
                </p>
                <p class="text-xs text-gray-500 mt-2 max-w-2xl mx-auto">
                    <strong>Disclaimer:</strong> Pythia<sup>TM</sup> is an independent analysis tool. Scores are heuristic-based and for informational purposes only. </p>
            </div>

            <div class="modern-card bg-white rounded-2xl shadow-xl p-6 mb-8">
                <div class="flex flex-col md:flex-row gap-4">
                    <input
                        id="urlInput"
                        type="url"
                        value="https://"
                        placeholder="https://example.com"
                        class="flex-1 px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-indigo-500 transition"
                    >
                    <button
                        id="scanBtn"
                        class="retro-button px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-xl hover:from-indigo-700 hover:to-purple-700 transition transform hover:scale-105"
                    >
                        ANALYZE
                        <span id="scanSpinner" class="retro-spinner" style="display:none;"></span>
                    </button>
                    <button
                        id="exportBtn"
                        class="retro-button px-6 py-3 bg-gray-600 text-white font-bold rounded-xl hover:bg-gray-700 transition"
                        style="display:none;"
                    >
                        üìä EXPORT
                    </button>
                </div>
            </div>

            <div id="pscoreContainer" class="hidden mb-8">
                <div class="modern-card bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl shadow-2xl p-8 text-center text-white">
                    <div class="text-sm font-bold uppercase tracking-wider opacity-90 mb-2">Overall P-Score</div>
                    <div id="pscoreValue" class="text-7xl font-bold mb-2">--</div>
                    <div class="text-lg opacity-90">Performance ‚Ä¢ Sustainability ‚Ä¢ Future-Ready</div>
                    <div id="siteInfo" class="text-sm opacity-75 mt-3"></div>
                </div>
            </div>

            <div id="pillar1-performance-container" class="hidden grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                </div>

            <div id="pillar2-quality-container" class="hidden grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                </div>

            <div id="pillar3-future-container" class="hidden grid grid-cols-2 md:grid-cols-3 gap-4 mb-8 max-w-lg mx-auto">
                </div>

            <div id="leaderboard" class="hidden modern-card bg-white rounded-2xl shadow-xl p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4"> üèÜ Global Leaderboard</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-bold text-green-600 mb-3">Top 10 Sites (User Scanned)</h3>
                        <div id="topSites" class="space-y-2"></div>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-red-600 mb-3">Bottom 10 Sites (User Scanned)</h3>
                        <div id="bottomSites" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-8 mb-8">
                <div class="modern-card bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2"> ‚öîÔ∏è Rivalry Battle Arena</h2>
                    <p class="text-sm text-gray-600 mb-4">Pit legendary rivals against each other</p>
                    <div class="mb-6">
                        <h3 class="text-lg font-bold text-indigo-600 mb-3">Epic Rivalries (41 Battles)</h3>
                        <div id="rivalryList" class="max-h-96 overflow-y-auto space-y-2 border rounded-lg p-3">
                        </div>
                    </div>
                    <div class="border-t pt-6">
                        <h3 class="text-lg font-bold text-purple-600 mb-3">Custom Battle</h3>
                        <div class="grid gap-4 mb-4">
                            <input id="customUrl1" type="text" value="https://" placeholder="example1.com"
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-indigo-500">
                            <input id="customUrl2" type="text" value="https://" placeholder="example2.com"
                                class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-indigo-500">
                        </div>
                        <button id="customBattleBtn" class="retro-button w-full py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition">
                            ‚öîÔ∏è START CUSTOM BATTLE
                        </button>
                    </div>
                </div>

                <div class="modern-card bg-white rounded-2xl shadow-xl p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2"> üåç World's Top 50 Websites</h2>
                    <p class="text-sm text-gray-600 mb-4">Scan the most popular sites by monthly traffic</p>
                    <button id="scanTop50Btn" class="retro-button w-full py-4 bg-gradient-to-r from-green-600 to-teal-600 text-white font-bold rounded-lg hover:from-green-700 hover:to-teal-700 transition mb-4">
                        üöÄ SCAN TOP 50 WEBSITES
                    </button>
                    <div id="top50Loading" class="hidden text-center py-8">
                        <div class="text-4xl mb-2"> ‚è≥ </div>
                        <div class="font-bold text-gray-700">Scanning top 50 websites...</div>
                        <div class="text-sm text-gray-500 mt-2">This takes 2-3 minutes</div>
                        <div id="scanProgress" class="text-xs text-gray-400 mt-1"></div>
                    </div>
                    <div id="top50Results" class="hidden">
                        <h3 class="text-lg font-bold text-green-600 mb-3"> ü•á Top 5 Global Sites</h3>
                        <div id="top50TopList" class="space-y-2 mb-6"></div>
                        <h3 class="text-lg font-bold text-red-600 mb-3"> ü•Ñ Wooden Spoon Award</h3>
                        <div id="top50BottomList" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <div id="battleResults" class="hidden modern-card mb-8 p-6 rounded-lg border-4 border-yellow-400 bg-gradient-to-r from-yellow-50 to-orange-50">
                <div class="text-center">
                    <div id="winnerAnnouncement" class="text-4xl font-bold mb-4"></div>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div id="contestant1Results" class="p-4 bg-white rounded-lg shadow"></div>
                        <div id="contestant2Results" class="p-4 bg-white rounded-lg shadow"></div>
                    </div>
                    <button id="shareRivalryBtn" class="mt-4 px-6 py-2 bg-blue-500 text-white font-bold rounded-lg hover:bg-blue-600">
                        üì¢ SHARE THIS BATTLE
                    </button>
                </div>
            </div>

            <div class="mt-8 text-center text-sm text-gray-500">
                <p>Powered by independent analysis, Green Web Foundation API, and advanced heuristics</p>
                <p class="mt-1">Analysis time varies 5-15 seconds ‚Ä¢ Scores cached 5min for stability</p>
                <div class="mt-6 flex justify-center gap-3 flex-wrap">
                    <button onclick="shareOn('twitter')" class="px-4 py-2 bg-blue-400 text-white rounded-lg hover:bg-blue-500 transition text-xs font-bold"> ùïè Share on X </button>
                    <button onclick="shareOn('facebook')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-xs font-bold"> üìò Share on Facebook </button>
                    <button onclick="shareOn('whatsapp')" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-xs font-bold"> üí¨ Share on WhatsApp </button>
                    <button onclick="shareOn('email')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition text-xs font-bold"> ‚úâÔ∏è Share via Email </button>
                </div>
                <p id="retroQuote" class="mt-4 text-xs italic text-gray-400" style="display:block;"> "I am in doubt whether to pronounce you man or god,<br>but I think rather you are a god, Lycurgus."
                </p>
            </div>
        </div>

        <div id="pscoreExplainerPage" class="page-content">
            <button onclick="showPage('main')" class="back-button mb-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">‚Üê Back</button>
            <div class="modern-card bg-white rounded-2xl shadow-xl p-8">
                <h1 class="text-4xl font-bold text-indigo-600 mb-6"> üìä P-Score Explainer</h1>
                <div class="prose max-w-none">
                    <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-3">What is the P-Score?</h2>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        The P-Score (Performance Score) is Pythia<sup>TM</sup>'s unified metric that distills complex website analysis into a single, actionable number from 0-100. Think of it as a health checkup for your digital presence.
                    </p>
                    <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-3">How It Works</h2>
                    <p class="text-gray-700 leading-relaxed mb-4">
                        Pythia<sup>TM</sup> analyzes 10 distinct aspects of your website‚Äîfrom lightning-fast loading times to privacy practices‚Äîand intelligently weighs them based on what matters most to modern users and search engines. </p>
                    <div class="bg-indigo-50 p-6 rounded-lg my-6">
                        <h3 class="text-xl font-bold text-indigo-600 mb-3">Weighting Philosophy</h3>
                        <p class="weighting-philosophy text-gray-700 mb-2">The P-Score intelligently balances multiple factors:</p>
                        <ul class="weighting-philosophy list-disc ml-6 text-gray-700 space-y-1">
                            <li><strong>Performance</strong> - Speed and responsiveness</li>
                            <li><strong>Accessibility</strong> - Inclusive design for all users</li>
                            <li><strong>Privacy & Security</strong> - User protection</li>
                            <li><strong>SEO & Discoverability</strong> - Search engine optimization</li>
                            <li><strong>Mobile Experience</strong> - Responsive design</li>
                            <li><strong>Sustainability</strong> - Environmental impact</li>
                            <li><strong>Modern Technology</strong> - Future-readiness</li>
                            <li><strong>And more...</strong></li>
                        </ul>
                        <p class="text-sm text-gray-600 mt-3 italic">Each factor is weighted according to its impact on user experience and modern web standards.</p>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-3">Score Ranges</h2>
                    <div class="grid md:grid-cols-3 gap-4 my-4">
                        <div class="p-4 bg-green-50 border-2 border-green-500 rounded-lg">
                            <div class="text-3xl font-bold text-green-600">80-100</div>
                            <div class="text-sm text-gray-700">Excellent - Top tier performance</div>
                        </div>
                        <div class="p-4 bg-yellow-50 border-2 border-yellow-500 rounded-lg">
                            <div class="text-3xl font-bold text-yellow-600">60-79</div>
                            <div class="text-sm text-gray-700">Good - Room for optimization</div>
                        </div>
                        <div class="p-4 bg-red-50 border-2 border-red-500 rounded-lg">
                            <div class="text-3xl font-bold text-red-600">0-59</div>
                            <div class="text-sm text-gray-700">Needs Work - Critical...

<div id="componentsPage" class="page-content">
    <button onclick="showPage('main')" class="back-button mb-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">‚Üê Back</button>
    <div class="modern-card bg-white rounded-2xl shadow-xl p-8">
        <h1 class="text-4xl font-bold text-indigo-600 mb-6"> üîß P-Score Components</h1>
        <div class="space-y-6">
            <div class="border-l-4 border-indigo-500 pl-4">
                <h3 class="text-xl font-bold text-indigo-600">Karpov Speed</h3>
                <p class="component-description text-gray-700">Measures the raw load time of the main page and the number of resources requested. It acts as a primary proxy for the perceived performance and Largest Contentful Paint (LCP) Core Web Vital.</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-yellow-500 pl-4">
                <h3 class="text-xl font-bold text-yellow-600">Tyche Interactivity</h3>
                <p class="component-description text-gray-700">Measures the efficiency of script loading. It heavily penalizes slow-loading third-party scripts and awards bonuses for using async/defer attributes to prevent main-thread blocking (proxy for Interaction to Next Paint - INP).</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-green-500 pl-4">
                <h3 class="text-xl font-bold text-green-600">Vortex Access</h3>
                <p class="component-description text-gray-700">A high-priority index scoring accessibility. It checks for image alt tags,...
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-cyan-500 pl-4">
                <h3 class="text-xl font-bold text-cyan-600">Nexus Mobile</h3>
                <p class="component-description text-gray-700">Scores responsiveness and mobile usability, checking for the viewport meta tag, touch targets, and text size.</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-purple-500 pl-4">
                <h3 class="text-xl font-bold text-purple-600">Pulse Security</h3>
                <p class="component-description text-gray-700">Scores SSL configuration, presence of security-related headers (HSTS, CSP), and vulnerability to common web attacks.</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-yellow-600 pl-4">
                <h3 class="text-xl font-bold text-yellow-600">Helix Privacy</h3>
                <p class="component-description text-gray-700">Penalizes excessive third-party trackers (like Google Analytics, Meta Pixel) and rewards the presence of a clear privacy policy link.</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-indigo-600 pl-4">
                <h3 class="text-xl font-bold text-indigo-600">Nova Scalability</h3>
                <p class="component-description text-gray-700">Rewards caching headers, CDN usage, and compression, indicating a site's ability to handle high traffic and scale efficiently.</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-orange-600 pl-4">
                <h3 class="text-xl font-bold text-orange-600">Aether Tech</h3>
                <p class="component-description text-gray-700">Rewards the adoption of modern, performance-enhancing web technologies such as Service Workers, WebAssembly, modern image formats (WebP/AVIF), and ES6 modules.</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-red-500 pl-4">
                <h3 class="text-xl font-bold text-red-600">Quantum Quality</h3>
                <p class="component-description text-gray-700">A general code quality index. It checks for HTML/CSS best practices, including doctype, proper tag closure, and the absence of deprecated or broken code patterns.</p>
            </div>
            <hr class="my-4">
            <div class="border-l-4 border-lime-500 pl-4">
                <h3 class="text-xl font-bold text-lime-600">Echo Green</h3>
                <p class="component-description text-gray-700">Scores the sustainability of the hosting environment by checking if the server is powered by renewable energy, based on a lookup against the Green Web Foundation.</p>
            </div>
        </div>
        <div class="mt-8 p-6 bg-indigo-50 rounded-lg">
            <h3 class="text-lg font-bold text-indigo-600 mb-2">Methodology Note</h3>
            <p class="text-sm text-gray-700"> Each component uses a combination of live API calls (PageSpeed Insights, Green Web Foundation) and proprietary heuristics analyzing HTML structure, headers, and resource loading. The algorithm is continuously refined based on industry best practices. </p>
        </div>
    </div>
</div>
<div id="customPage" class="page-content">
    <button onclick="showPage('main')" class="back-button mb-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">‚Üê Back</button>
    <div class="modern-card bg-white rounded-2xl shadow-xl p-8 text-center">
        <h1 class="text-4xl font-bold text-indigo-600 mb-4"> üíé Custom Scan Pro (Unlock)</h1>
        <p class="text-xl text-gray-700 mb-6">Upgrade to Pythia Pro to unlock:</p>
        <ul class="list-disc list-inside text-left mx-auto max-w-sm space-y-2 mb-8 text-gray-700">
            <li><strong>Unlimited Scans:</strong> No rate limits for power users.</li>
            <li><strong>Deep Component Breakdown:</strong> See why each component scored as it did.</li>
            <li><strong>API Access:</strong> Integrate Pythia's data into your own tools.</li>
            <li><strong>Historical Tracking:</strong> Monitor a site's P-Score over time.</li>
            <li><strong>PDF Export:</strong> Generate shareable, professional reports.</li>
        </ul>
        <button class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-xl font-bold rounded-xl hover:from-indigo-700 hover:to-purple-700 transition transform hover:scale-105 shadow-lg"> üöÄ Subscribe Now - $5/month </button>
        <p class="text-sm text-gray-500 mt-4">Secure payment via Stripe ‚Ä¢ Instant activation</p>
    </div>
    <div class="mt-8 p-6 bg-yellow-50 border-2 border-yellow-400 rounded-lg">
        <h3 class="text-lg font-bold text-yellow-800 mb-2"> üéØ Perfect For:</h3>
        <ul class="text-gray-700 space-y-1">
            <li>‚Ä¢ <strong>Agencies</strong> managing multiple client websites</li>
            <li>‚Ä¢ <strong>Developers</strong> optimizing performance before launch</li>
            <li>‚Ä¢ <strong>Marketing teams</strong> tracking competitor sites</li>
            <li>‚Ä¢ <strong>Site owners</strong> committed to continuous improvement</li>
        </ul>
    </div>
</div>
<div id="aboutPage" class="page-content">
    <button onclick="showPage('main')" class="back-button mb-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">‚Üê Back</button>
    <div class="modern-card bg-white rounded-2xl shadow-xl p-8">
        <h1 class="text-4xl font-bold text-indigo-600 mb-6"> ‚ÑπÔ∏è About Pythia<sup>TM</sup></h1>
        <div class="prose max-w-none about-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-3">The Oracle of Web Performance</h2>
            <p class="text-gray-700">Pythia is named after the high priestess at the Temple of Apollo at Delphi, who served as the oracle. Just as the ancient Pythia provided cryptic, yet profound, guidance, our Pythia<sup>TM</sup> system provides a profound, unified score for the modern web‚Äîa single point of truth in a complex digital world.</p>
            <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-3">Core Philosophy</h2>
            <p class="text-gray-700">We believe a truly high-quality website must excel in three core pillars: **Performance** (speed, efficiency), **Quality** (accessibility, security, privacy), and **Future-Readiness** (sustainability, modern tech). The P-Score is designed to challenge the industry to build sites that are fast, ethical, and built to last.</p>
            <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-3">Open Roadmap</h2>
            <p class="text-gray-700">Pythia is currently in BETA. We are continuously refining our scoring algorithms and adding new features. Your feedback shapes our roadmap‚Äîreach out via the menu if you have suggestions! </p>
            <div class="mt-8 text-center">
                <p class="text-sm text-gray-500"> Questions? Feedback? Partnership inquiries?<br> Contact us: <a href="mailto:hello@cronixholdings.com" class="text-indigo-600 font-bold hover:underline">hello@cronixholdings.com</a> </T> </div>
        </div>
    </div>
</div>
</div>
<script>
    // === CONFIGURATION ===
    const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes in milliseconds
    // ------------------------------------------------------------------
    // üõ†Ô∏è FIX: INSERT THE METRICS DEFINITION HERE
    // ------------------------------------------------------------------
    const METRICS = [
        { id: 'karpov', name: 'Karpov Speed', desc: 'Load time & efficiency', color: 'from-blue-500 to-indigo-500', tooltip: 'Measures page load time, resource count, and general optimization techniques (LCP proxy).' },
        { id: 'tyche', name: 'Tyche Interactivity', desc: 'Script management & responsiveness', color: 'from-yellow-500 to-orange-500', tooltip: 'Measures script load efficiency, penalizing third-party and inline scripts while rewarding async/defer (INP/TBT proxy).' },
        { id: 'vortex', name: 'Vortex Access', desc: 'Accessibility score', color: 'from-green-500 to-emerald-500', tooltip: 'Evaluates image alt text, ARIA labels, semantic HTML, and core accessibility features.' },
        { id: 'nexus', name: 'Nexus Mobile', desc: 'Mobile responsiveness', color: 'from-cyan-500 to-blue-500', tooltip: 'Checks for viewport meta tag, proper sizing, and responsive design practices.' },
        { id: 'helix', name: 'Helix Privacy', desc: 'Trackers & data control', color: 'from-yellow-600 to-orange-600', tooltip: 'Penalizes third-party trackers (Analytics, Pixels) and rewards clear privacy declarations.' },
        { id: 'pulse', name: 'Pulse SEO', desc: 'Discoverability', color: 'from-purple-500 to-pink-500', tooltip: 'Scores based on key SEO elements like title, meta description, and social media tags.' },
        { id: 'nova', name: 'Nova Scalability', desc: 'Infrastructure & caching', color: 'from-indigo-600 to-purple-600', tooltip: 'Rewards CDN use, strong caching headers, and compression.' },
        { id: 'eden', name: 'Eden Efficiency', desc: 'Page weight & size', color: 'from-teal-500 to-green-500', tooltip: 'Scores based on total page weight. Smaller sites (under 500KB) score higher.' },
        { id: 'aether', name: 'Aether Tech', desc: 'Modern technologies', color: 'from-orange-500 to-red-500', tooltip: 'Detects WebAssembly, Service Workers, ES6 modules, and modern frameworks.' },
        { id: 'quantum', name: 'Quantum Quality', desc: 'Best practices & code', color: 'from-red-500 to-pink-500', tooltip: 'Checks for code quality, integrity, and adherence to HTML/CSS best practices.' },
        { id: 'echo', name: 'Echo Green', desc: 'Sustainable hosting', color: 'from-lime-500 to-green-600', tooltip: 'Checks if hosting uses renewable energy via Green Web Foundation API.' }
    ];
    // ------------------------------------------------------------------
    // üõ†Ô∏è END OF FIX
    // ------------------------------------------------------------------
    // === RIVALRIES DATA (Original) ===
    const RIVALRIES = [
        { category: 'Academic', name1: 'Oxford', url1: 'https://www.ox.ac.uk', name2: 'Cambridge', url2: 'https://www.cam.ac.uk' },
        { category: 'Academic', name1: 'Harvard', url1: 'https://www.harvard.edu', name2: 'Yale', url2: 'https://www.yale.edu' },
        { category: 'Academic', name1: 'MIT', url1: 'https://www.mit.edu', name2: 'Caltech', url2: 'https://www.caltech.edu' },
        { category: 'Sport', name1: 'India (BCCI)', url1: 'https://www.bcci.tv', name2: 'Pakistan (PCB)', url2: 'https://www.pcb.com.pk' },
        { category: 'Sport', name1: 'England (ECB)', url1: 'https://www.ecb.co.uk', name2: 'Australia', url2: 'https://www.cricket.com.au' },
        { category: 'Sport', name1: 'Springboks', url1: 'https://www.sarugby.co.za', name2: 'All Blacks', url2: 'https://www.nzrugby.co.nz' },
        { category: 'Sport', name1: 'Manchester United', url1: 'https://www.manutd.com', name2: 'Liverpool', url2: 'https://www.liverpoolfc.com' },
        { category: 'Sport', name1: 'Arsenal', url1: 'https://www.arsenal.com', name2: 'Chelsea', url2: 'https://www.chelseafc.com' },
        { category: 'Sport', name1: 'FIFA', url1: 'https://www.fifa.com', name2: 'UEFA', url2: 'https://www.uefa.com' },
        { category: 'Tech', name1: 'Apple', url1: 'https://www.apple.com', name2: 'Samsung', url2: 'https://www.samsung.com' },
        { category: 'Tech', name1: 'Microsoft', url1: 'https://www.microsoft.com', name2: 'Amazon', url2: 'https://www.amazon.com' },
        { category: 'Media', name1: 'NY Times', url1: 'https://www.nytimes.com', name2: 'Washington Post', url2: 'https://www.washingtonpost.com' },
        { category: 'Media', name1: 'BBC News', url1: 'https://www.bbc.com/news', name2: 'CNN', url2: 'https://www.cnn.com' },
        { category: 'Finance', name1: 'FT', url1: 'https://www.ft.com', name2: 'WSJ', url2: 'https://www.wsj.com' },
        { category: 'Finance', name1: 'J.P. Morgan', url1: 'https://www.jpmorgan.com', name2: 'Goldman Sachs', url2: 'https://www.goldmansachs.com' },
        { category: 'Travel', name1: 'Booking.com', url1: 'https://www.booking.com', name2: 'Expedia', url2: 'https://www.expedia.com' },
        { category: 'Travel', name1: 'Airbnb', url1: 'https://www.airbnb.com', name2: 'Vrbo', url2: 'https://www.vrbo.com' },
        { category: 'Automotive', name1: 'BMW', url1: 'https://www.bmw.com', name2: 'Mercedes-Benz', url2: 'https://www.mercedes-benz.com' },
        { category: 'Automotive', name1: 'Tesla', url1: 'https://www.tesla.com', name2: 'Rivian', url2: 'https://rivian.com' },
        { category: 'Food', name1: 'Coca-Cola', url1: 'https://www.coca-cola.com', name2: 'PepsiCo', url2: 'https://www.pepsico.com' },
        { category: 'Food', name1: 'McDonalds', url1: 'https://www.mcdonalds.com', name2: 'Burger King', url2: 'https://www.bk.com' },
        { category: 'Fashion', name1: 'Nike', url1: 'https://www.nike.com', name2: 'Adidas', url2: 'https://www.adidas.com' },
        { category: 'Fashion', name1: 'Gucci', url1: 'https://www.gucci.com', name2: 'Louis Vuitton', url2: 'https://www.louisvuitton.com' },
        { category: 'Science', name1: 'NASA', url1: 'https://www.nasa.gov', name2: 'ESA', url2: 'https://www.esa.int' },
        { category: 'Science', name1: 'CERN', url1: 'https://home.cern', name2: 'ITER', url2: 'https://www.iter.org' },
        { category: 'Space', name1: 'SpaceX', url1: 'https://www.spacex.com', name2: 'Blue Origin', url2: 'https://www.blueorigin.com' },
        { category: 'Energy', name1: 'ExxonMobil', url1: 'https://corporate.exxonmobil.com', name2: 'Shell', url2: 'https://www.shell.com' },
        { category: 'Energy', name1: 'Vestas', url1: 'https://www.vestas.com', name2: 'Siemens Gamesa', url2: 'https://www.siemensgamesa.com' },
        { category: 'Gaming', name1: 'PlayStation', url1: 'https://www.playstation.com', name2: 'Xbox', url2: 'https://www.xbox.com' },
        { category: 'Gaming', name1: 'Nintendo', url1: 'https://www.nintendo.com', name2: 'Valve (Steam)', url2: 'https://www.valvesoftware.com' },
        { category: 'Software', name1: 'Salesforce', url1: 'https://www.salesforce.com', name2: 'SAP', url2: 'https://www.sap.com' },
        { category: 'Software', name1: 'Adobe', url1: 'https://www.adobe.com', name2: 'Autodesk', url2: 'https://www.autodesk.com' },
        { category: 'Retail', name1: 'Walmart', url1: 'https://www.walmart.com', name2: 'Target', url2: 'https://www.target.com' },
        { category: 'Retail', name1: 'IKEA', url1: 'https://www.ikea.com', name2: 'Home Depot', url2: 'https://www.homedepot.com' },
        { category: 'Telecom', name1: 'Verizon', url1: 'https://www.verizon.com', name2: 'AT&T', url2: 'https://www.att.com' },
        { category: 'Telecom', name1: 'T-Mobile', url1: 'https://www.t-mobile.com', name2: 'Vodafone', url2: 'https://www.vodafone.com' },
        { category: 'Government', name1: 'UN', url1: 'https://www.un.org', name2: 'NATO', url2: 'https://www.nato.int' },
        { category: 'Government', name1: 'G7', url1: 'https://www.g7germany.de', name2: 'G20', url2: 'https://www.g20.org' },
        { category: 'Tech', name1: 'Google', url1: 'https://www.google.com', name2: 'Meta', url2: 'https://about.meta.com' },
        { category: 'Tech', name1: 'DeepMind', url1: 'https://www.deepmind.com', name2: 'OpenAI', url2: 'https://www.openai.com' },
        { category: 'Tech', name1: 'Anthropic', url1: 'https://www.anthropic.com', name2: 'xAI', url2: 'https://x.ai' },
        { category: 'Automotive', name1: 'McLaren', url1: 'https://www.mclaren.com', name2: 'Red Bull Racing', url2: 'https://www.redbullracing.com' },
        { category: 'Automotive', name1: 'Ferrari', url1: 'https://www.ferrari.com', name2: 'Porsche', url2: 'https://www.porsche.com' },
        { category: 'Socials', name1: 'X', url1: 'https://www.x.com', name2: 'Threads', url2: 'https://www.threads.net' },
        { category: 'Socials', name1: 'TikTok', url1: 'https://www.tiktok.com', name2: 'YouTube', url2: 'https://www.youtube.com' },
        { category: 'Socials', name1: 'LinkedIn', url1: 'https://www.linkedin.com', name2: 'Xing', url2: 'https://www.xing.com' }
    ];
    // === STATE (Original) ===
    let currentData = null;
    let currentBattleData = null;
    // --- NEW STATE VARIABLES ---
    let isRetro = true; // Default to RETRO
    let soundsEnabled = true; // Default to ON
    // --- NEW: BOOT SEQUENCE CONFIG ---
    const BOOT_LOG_LINES = [
        "Initializing Oracle...",
        "Booting Indices...",
        "Calibrating Metrics...",
        "Verifying System Integrity... OK",
        "Establishing Connection to Delphi...",
        "Loading Web Analysis Engine...",
        "Done."
    ];
    const BOOT_SEQUENCE_TIME_PER_LINE = 35; // CHANGED from 300
    const BOOT_PAUSE_TIME = 80; // CHANGED from 1500
    // --- NEW: AUDIO SETUP ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(frequency, duration, type = 'sine', gain = 0.1) {
        if (!soundsEnabled) return;
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        oscillator.type = type;
        oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(gain, audioCtx.currentTime);

        // Fade out
        gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);

        oscillator.start();
        setTimeout(() => {
            oscillator.stop();
        }, duration * 1000);
    }

    function playClick() { playSound(440, 0.05, 'square'); }
    function playAnalyze() { playSound(660, 0.1, 'sawtooth', 0.15); playSound(880, 0.1, 'sawtooth', 0.1); }
    function playSuccess() { playSound(900, 0.1, 'sine', 0.2); playSound(1200, 0.2, 'sine', 0.2); }
    function playError() { playSound(100, 0.5, 'square', 0.2); }

    // === THEME TOGGLE (Original) ===
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    document.getElementById('soundToggle').addEventListener('click', toggleSound);

    function toggleTheme() {
        isRetro = !isRetro;
        document.body.classList.toggle('retro', isRetro);
        document.getElementById('themeToggle').textContent = isRetro ? '‚ú® BORING MODE' : 'üíª RETRO MODE';
        document.getElementById('retroQuote').style.display = isRetro ? 'block' : 'none';
        displayResults(currentData, true); // Re-render if data exists to apply new colors
        playClick();
    }

    function toggleSound() {
        soundsEnabled = !soundsEnabled;
        document.getElementById('soundToggle').textContent = soundsEnabled ? 'üîä Sounds ON' : 'üîá Sounds OFF';
        playClick(); // Play click sound if just enabled
    }

    // === BOOT SEQUENCE (New) ===
    function typeBootLine(text, el, delay) {
        return new Promise(resolve => {
            setTimeout(() => {
                const lineEl = document.createElement('div');
                lineEl.classList.add('boot-line');
                el.appendChild(lineEl);
                lineEl.style.opacity = 1;
                lineEl.textContent = '> ';

                let i = 0;
                lineEl.style.animation = `typing 1s steps(${text.length}, end), blink-caret .75s step-end infinite`; // CHANGED from 1s

                // Wait for the animation to end naturally, then remove animation/caret
                setTimeout(() => {
                    lineEl.textContent = `> ${text}`;
                    lineEl.style.animation = 'none';
                    lineEl.style.borderRight = 'none';
                    resolve();
                }, 1000); // 1s matches the CSS typing duration
                
                // Set the text content after a slight delay to start the effect
                setTimeout(() => {
                    lineEl.textContent = `> ${text}`;
                }, 50);

            }, delay);
        });
    }


    async function initializePage() {
        const bootLog = document.getElementById('bootLog');
        const mainWrapper = document.getElementById('mainWrapper');

        for (const line of BOOT_LOG_LINES) {
            await typeBootLine(line, bootLog, BOOT_SEQUENCE_TIME_PER_LINE * (0.5 + Math.random()));
        }

        await new Promise(resolve => setTimeout(resolve, BOOT_PAUSE_TIME)); // Fade out boot screen
        
        document.getElementById('bootSequence').style.transition = 'opacity 0.5s';
        document.getElementById('bootSequence').style.opacity = 0;
        
        // Fade in main content
        mainWrapper.style.display = 'block';
        mainWrapper.classList.add('pixellated-fade');
        
        setTimeout(() => {
            document.getElementById('bootSequence').style.display = 'none';
            document.body.style.overflow = 'auto'; // Re-enable scrolling
        }, 500);

        // Run original setup
        updateLeaderboardDisplay();
        renderRivalries();
    }
    
    // Start boot sequence on load
    document.addEventListener('DOMContentLoaded', initializePage);
    
    // === MENU FUNCTIONS (Original) ===
    function openMenu() {
        document.getElementById('menuOverlay').classList.add('open');
        document.getElementById('menuBackdrop').classList.add('open');
        playClick();
    }

    function closeMenu() {
        document.getElementById('menuOverlay').classList.remove('open');
        document.getElementById('menuBackdrop').classList.remove('open');
        playClick();
    }

    function showPage(pageId) {
        document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
        const pageMap = {
            'main': 'mainPage',
            'pscore-explainer': 'pscoreExplainerPage',
            'components': 'componentsPage',
            'custom': 'customPage',
            'about': 'aboutPage'
        };
        document.getElementById(pageMap[pageId]).classList.add('active');
        closeMenu();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        playClick();
    }

    // === CACHING (Original) ===
    function getCachedScan(url) {
        const key = \`pscore_cache_\${url}\`;
        const cached = localStorage.getItem(key);
        if (cached) {
            const data = JSON.parse(cached);
            if (Date.now() - data.timestamp < CACHE_DURATION) {
                return data.result;
            } else {
                localStorage.removeItem(key);
            }
        }
        return null;
    }

    function setCachedScan(url, result) {
        const key = \`pscore_cache_\${url}\`;
        const data = {
            timestamp: Date.now(),
            result: result
        };
        localStorage.setItem(key, JSON.stringify(data));
        updateLeaderboard(result);
    }
    
    // === MAIN SCANNER (Original) ===
    document.getElementById('scanBtn').addEventListener('click', analyzeSite);

    async function analyzeSite() {
        playAnalyze(); // NEW
        const url = document.getElementById('urlInput').value.trim();
        if (!url || !url.startsWith('http')) {
            alert('Please enter a valid URL starting with http:// or https://');
            return;
        }

        const cached = getCachedScan(url);
        if (cached) {
            console.log('Using cached result');
            currentData = cached;
            displayResults(cached, true);
            return;
        }

        const scanBtn = document.getElementById('scanBtn');
        const scanSpinner = document.getElementById('scanSpinner'); // NEW
        
        scanBtn.disabled = true;
        scanBtn.classList.add('scanning');
        scanSpinner.style.display = 'inline-block'; // NEW

        // Hide old results
        const pscoreContainer = document.getElementById('pscoreContainer');
        if (pscoreContainer) pscoreContainer.classList.add('hidden');
        const exportBtn = document.getElementById('exportBtn');
        if (exportBtn) exportBtn.style.display = 'none';

        // --- THIS IS THE CORRECTED API CALL ---
        try {
            const response = await fetch('/api/scan', { // <-- Calls your API
                method: 'POST', // <-- Uses POST
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url }) // <-- Sends the URL in the body
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({})); // Use the 'error' field from the backend response
                throw new Error(errorData.error || \`HTTP \${response.status} - \${response.statusText}\`);
            }

            const data = await response.json();
            if (data.error) {
                throw new Error(data.message || data.error || 'Unknown error from API');
            }

            setCachedScan(url, data);
            currentData = data;
            displayResults(data, false);

        } catch (error) {
            playError(); // NEW
            alert(\`Scan failed: \${error.message}\`);
        } finally {
            scanBtn.disabled = false;
            scanBtn.classList.remove('scanning');
            scanSpinner.style.display = 'none'; // NEW
        }
    }

    function displayResults(data, isCached) {
        playSuccess(); // NEW
        const pscoreContainer = document.getElementById('pscoreContainer');
        const pscoreValue = document.getElementById('pscoreValue');
        const siteInfo = document.getElementById('siteInfo');
        const exportBtn = document.getElementById('exportBtn');

        // Update main score
        pscoreValue.textContent = data.pscore;
        siteInfo.innerHTML = \`\${new URL(data.url).hostname} 
            <span class="cache-badge \${isCached ? 'cache-stored' : 'cache-live'}">\${isCached ? 'CACHED' : 'LIVE SCAN'}</span> 
            (Last scan: \${new Date(data.timestamp).toLocaleDateString()})\`;
        pscoreContainer.classList.remove('hidden');
        exportBtn.style.display = 'inline-block';

        // Helper to generate the metric card HTML
        const cardHtml = (metric) => {
            // Since we fixed the backend to flatten scores, we can access them directly:
            const score = data[metric.id] !== undefined ? data[metric.id] : '--';
            const scoreColor = score >= 80 ? 'text-green-600' : (score >= 60 ? 'text-yellow-600' : 'text-red-600');
            const retroScoreColor = score >= 80 ? 'text-green-400' : (score >= 60 ? 'text-yellow-400' : 'text-red-400');

            return \`
                <div class="score-card modern-card bg-white rounded-xl shadow-md p-4 flex flex-col justify-between transition transform hover:scale-[1.03]">
                    <div class="text-xs font-bold uppercase \${metric.id === 'echo' ? 'text-lime-800' : 'text-gray-500'}">
                        \${metric.id.toUpperCase()}
                        <div class="tooltip ml-1 inline-block cursor-pointer text-gray-400 hover:text-gray-700">
                            (i)
                            <span class="tooltiptext">\${metric.tooltip}</span>
                        </div>
                    </div>
                    <div class="text-2xl font-bold \${isRetro ? retroScoreColor : scoreColor} my-1">\${score}</div>
                    <div class="text-sm text-gray-700 font-medium">\${metric.name}</div>
                </div>
            \`;
        };

        // Split the METRICS array into the three pillars for display. This defines the missing variables.
        const p1metrics = METRICS.slice(0, 4); // Pillar 1: Performance (Karpov, Tyche, Vortex, Nexus)
        const p2metrics = METRICS.slice(4, 8); // Pillar 2: Quality (Helix, Pulse, Nova, Eden) - Fixed P2 to be 4 long
        const p3metrics = METRICS.slice(8, 11); // Pillar 3: Future (Aether, Quantum, Echo) - Fixed P3 to be 3 long

        // Update the DOM with the generated HTML
        document.getElementById('pillar1-performance-container').innerHTML = p1metrics.map(cardHtml).join('');
        document.getElementById('pillar2-quality-container').innerHTML = p2metrics.map(cardHtml).join('');
        document.getElementById('pillar3-future-container').innerHTML = p3metrics.map(cardHtml).join('');

        // Show containers
        document.getElementById('pillar1-performance-container').classList.remove('hidden');
        document.getElementById('pillar2-quality-container').classList.remove('hidden');
        document.getElementById('pillar3-future-container').classList.remove('hidden');

        setTimeout(() => {
             window.scrollTo({ top: pscoreContainer.offsetTop - 20, behavior: 'smooth' });
        }, 100);
    }

    // === LEADERBOARD (Original) ===

    function updateLeaderboard(result) {
        // [ ... LEADERBOARD LOGIC OMITTED FOR BREVITY ... ]
    }
    
    function updateLeaderboardDisplay() {
        // [ ... LEADERBOARD DISPLAY LOGIC OMITTED FOR BREVITY ... ]
    }

    // === RIVALRIES (MODIFIED) ===
    function renderRivalries() {
        // [ ... RIVALRIES RENDER LOGIC OMITTED FOR BREVITY ... ]
    }
    
    // [ ... BATTLE LOGIC OMITTED FOR BREVITY ... ]

    // === TOP 50 SCANNER (MODIFIED) ===

    const TOP_50_URLS = [
        "https://www.google.com", "https://www.youtube.com", "https://www.facebook.com", "https://www.baidu.com", "https://www.wikipedia.org",
        "https://www.yahoo.com", "https://www.qq.com", "https://www.amazon.com", "https://www.taobao.com", "https://www.twitter.com",
        "https://www.instagram.com", "https://www.live.com", "https://www.sina.com.cn", "https://www.linkedin.com", "https://www.weibo.com",
        "https://www.reddit.com", "https://www.bing.com", "https://www.netflix.com", "https://www.pinterest.com", "https://www.msn.com",
        "https://www.soso.com", "https://www.aliexpress.com", "https://www.vk.com", "https://www.microsoft.com", "https://www.apple.com",
        "https://www.stackoverflow.com", "https://www.github.com", "https://www.t.co", "https://www.ebay.com", "https://www.craigslist.org",
        "https://www.huanqiu.com", "https://www.xhamster.com", "https://www.pornhub.com", "https://www.xvideos.com", "https://www.canva.com",
        "https://www.twitch.tv", "https://www.office.com", "https://www.whatsapp.com", "https://www.etsy.com", "https://www.zoom.us",
        "https://www.quora.com", "https://www.roblox.com", "https://www.spotify.com", "https://www.paypal.com", "https://www.bbc.com",
        "https://www.nytimes.com", "https://www.cnn.com", "https://www.adobe.com", "https://www.salesforce.com", "https://www.ibm.com"
    ];


    document.getElementById('scanTop50Btn').addEventListener('click', handleTop50Scan);

    async function handleTop50Scan() {
        playAnalyze();
        const btn = document.getElementById('scanTop50Btn');
        const loadingDiv = document.getElementById('top50Loading');
        const resultsDiv = document.getElementById('top50Results');
        const progressDiv = document.getElementById('scanProgress');

        btn.disabled = true;
        btn.innerHTML = 'SCANNING... <span class="retro-spinner"></span>';
        loadingDiv.classList.remove('hidden');
        resultsDiv.classList.add('hidden');
        progressDiv.textContent = '0%';

        let scanResults = [];
        const BATCH_SIZE = 5;
        const totalBatches = Math.ceil(TOP_50_URLS.length / BATCH_SIZE);

        try {
            for (let i = 0; i < totalBatches; i++) {
                const batch = TOP_50_URLS.slice(i * BATCH_SIZE, (i + 1) * BATCH_SIZE);
                const scanPromises = batch.map(url => 
                    fetch('/api/scan', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url })
                    })
                    .then(response => response.json())
                    .catch(error => { 
                        console.error(\`Scan failed for \${url}: \${error.message}\`);
                        return { url, error: error.message }; 
                    })
                );

                const batchResults = await Promise.all(scanPromises);
                const validResults = batchResults.filter(r => r.pscore !== null && r.url && r.pscore !== undefined && !r.error);
                scanResults.push(...validResults);

                const progress = Math.round(((i + 1) * BATCH_SIZE / TOP_50_URLS.length) * 100);
                progressDiv.textContent = \`\${Math.min(100, progress)}% (\${scanResults.length} / \${TOP_50_URLS.length} sites completed)\`;

                console.log(\`Batch complete. Total valid scans: \${scanResults.length}/\${TOP_50_URLS.length}\`);
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            console.log(\`Top 50 scan complete. Successfully scanned: \${scanResults.length} sites\`);
            playSuccess();

            // Check if we have enough data to display the leaderboard
            if (scanResults.length >= 5) { // Needs at least 5 for the Top 5
                const sorted = scanResults.sort((a, b) => b.pscore - a.pscore); 

                // MODIFICATION (a) LOGIC: Top 10 -> Top 5
                const top5 = sorted.slice(0, 5); 
                
                // MODIFICATION (b) LOGIC: Bottom 10 -> Single Worst
                const worstSite = sorted[sorted.length - 1]; 
                
                const scanDate = new Date().toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });

                // RENDER TOP 5 LIST
                document.getElementById('top50TopList').innerHTML = top5.map((site, i) => \`
                    <div class="leaderboard-entry flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-indigo-50 transition rivalry-item">
                        <span class="text-sm font-bold text-gray-700">#\${i + 1}. \${new URL(site.url).hostname}</span>
                        <span class="text-lg font-bold text-green-600">\${site.pscore}</span>
                    </div>\`).join('');

                // RENDER WOODEN SPOON AWARD (Single Worst Site)
                document.getElementById('top50BottomList').innerHTML = \`
                    <div class="leaderboard-entry flex flex-col items-center p-6 bg-red-50 rounded-lg border-4 border-red-500 shadow-xl transition rivalry-item text-center">
                        <span class="text-sm font-black uppercase text-red-800 mb-1">P-Score:</span>
                        <span class="text-5xl font-black text-red-600">\${worstSite.pscore}</span>
                        <span class="text-xl font-extrabold text-red-800 mt-2">\${new URL(worstSite.url).hostname}</span>
                        <p class="text-xs text-red-500 mt-3 italic">Ranked #\${sorted.length} of \${sorted.length}. Lowest score recorded in this scan batch.</p>
                    </div>
                \`;

                // Update the loading text to completion/date
                document.getElementById('top50Loading').innerHTML = \`
                    <div class="text-xl font-bold text-gray-700 mb-2">Scan Complete!</div>
                    <div class="text-sm text-gray-500">Data Scanned: \${scanResults.length} sites</div>
                    <div class="text-xs text-gray-400 mt-1">Last Run: \${scanDate}</div>
                \`;
                
                resultsDiv.classList.remove('hidden');
                setTimeout(() => {
                    window.scrollTo({ top: resultsDiv.offsetTop - 50, behavior: 'smooth' });
                }, 100);


            } else {
                document.getElementById('top50Loading').innerHTML = '<div class="text-xl font-bold text-red-600">Scan Failed: Not enough sites scanned to generate a leaderboard (minimum 5 needed).</div>';
                playError();
            }

        } catch (error) {
            console.error('Top 50 Scan Error:', error);
            document.getElementById('top50Loading').innerHTML = \`<div class="text-xl font-bold text-red-600">Top 50 Scan Failed: \${error.message}</div>\`;
            playError();

        } finally {
            btn.disabled = false;
            btn.innerHTML = 'üöÄ SCAN TOP 50 WEBSITES';
            // loadingDiv.classList.add('hidden'); // Keep the summary visible
        }
    }


    // === SOCIAL SHARING (MODIFIED) ===
    function shareOn(platform) {
        playClick(); // NEW
        const text = 'Check out PythiaTM - The ultimate website performance oracle! ONE SCORE TO RANK THEM ALL üîÆ ';
        const url = window.location.href;
        shareContent(text, url, platform);
    }

    function shareContent(text, url, platform = null) {
        const encodedText = encodeURIComponent(text);
        const encodedUrl = encodeURIComponent(url);
        if (!platform) {
            if (navigator.share) {
                navigator.share({ title: 'Pythia', text, url });
            }
            return;
        }
        let shareUrl;
        switch(platform) {
            case 'twitter': shareUrl = \`https://twitter.com/intent/tweet?text=\${encodedText}&url=\${encodedUrl}\`; break;
            case 'facebook': shareUrl = \`https://www.facebook.com/sharer/sharer.php?u=\${encodedUrl}\`; break;
            case 'whatsapp': shareUrl = \`https://wa.me/?text=\${encodedText} \${encodedUrl}\`; break;
            case 'email': shareUrl = \`mailto:?subject=\${encodeURIComponent('Pythia')}&body=\${encodedText} \${encodedUrl}\`; break;
        }
        if (shareUrl) {
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }
    }
    
    // === INITIALIZE (Original) ===
    // updateLeaderboardDisplay(); // Moved to initializePage
</script>
</body>
</html>
